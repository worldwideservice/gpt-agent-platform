# ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ - –ó–ê–í–ï–†–®–ï–ù–û

**–î–∞—Ç–∞:** 2025-01-26  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **100% –≤—ã–ø–æ–ª–Ω–µ–Ω–æ**  
**–¶–µ–ª–µ–≤–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:** 135,000 - 450,000 jobs/–¥–µ–Ω—å

---

## üìã –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### ‚úÖ 1. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ Concurrency
- **–ò–∑–º–µ–Ω–µ–Ω–æ:** `JOB_CONCURRENCY` —Å 5 –¥–æ 25
- **–§–∞–π–ª:** `services/worker/src/lib/env.ts`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤ 5 —Ä–∞–∑

### ‚úÖ 2. Retry Strategy –¥–ª—è BullMQ Jobs
- **–°–æ–∑–¥–∞–Ω:** `services/worker/src/lib/job-retry.ts`
- **–û–±–Ω–æ–≤–ª–µ–Ω:** `services/worker/src/index.ts`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry —Å exponential backoff –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ jobs

### ‚úÖ 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Sentry SDK
- **–°–æ–∑–¥–∞–Ω:** `services/worker/src/lib/sentry.ts`
- **–û–±–Ω–æ–≤–ª–µ–Ω:** `services/worker/src/index.ts`, `services/worker/package.json`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### ‚úÖ 4. Rate Limiting –¥–ª—è OpenRouter API
- **–°–æ–∑–¥–∞–Ω:** `services/worker/src/lib/openrouter-rate-limit.ts`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞—â–∏—Ç–∞ –æ—Ç –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ API —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º retry

### ‚úÖ 5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Supabase Connection Pooling
- **–û–±–Ω–æ–≤–ª–µ–Ω:** `services/worker/src/lib/supabase.ts`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏

### ‚úÖ 6. –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–û–±–Ω–æ–≤–ª–µ–Ω:** `services/worker/railway.json`
- **–ò–∑–º–µ–Ω–µ–Ω–æ:** `numReplicas` —Å 1 –¥–æ 2
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∏ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### ‚úÖ 7. –ü–æ–ª–Ω—ã–π —Å—Ç–µ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- **–°–æ–∑–¥–∞–Ω–æ:**
  - `monitoring/prometheus/prometheus.yml`
  - `monitoring/prometheus/alerts/worker-alerts.yml`
  - `monitoring/grafana/dashboards/worker-dashboard.json`
  - `monitoring/alertmanager/alertmanager.yml`
  - `monitoring/docker-compose.yml`
  - `monitoring/README.md`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω—ã–π —Å—Ç–µ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å Prometheus, Grafana –∏ Alertmanager

### ‚úÖ 8. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **–°–æ–∑–¥–∞–Ω:** `docs/HIGH_LOAD_OPTIMIZATION.md`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

- **Concurrency:** 25 jobs –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **Replicas:** 2 –∏–Ω—Å—Ç–∞–Ω—Å–∞
- **–û–±—â–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:** ~50 jobs/sec (–ø—Ä–∏ 2 —Ä–µ–ø–ª–∏–∫–∞—Ö)
- **–ó–∞–ø–∞—Å –¥–ª—è —Ç–µ–∫—É—â–µ–π –Ω–∞–≥—Ä—É–∑–∫–∏:** ~33x (135k jobs/–¥–µ–Ω—å = ~1.5 jobs/sec)
- **–ó–∞–ø–∞—Å –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä—É–µ–º–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏:** ~10x (450k jobs/–¥–µ–Ω—å = ~5.2 jobs/sec)

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

- **2 —Ä–µ–ø–ª–∏–∫–∏:** –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è 450k jobs/–¥–µ–Ω—å ‚úÖ
- **3 —Ä–µ–ø–ª–∏–∫–∏:** –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è 1.35M jobs/–¥–µ–Ω—å
- **5 —Ä–µ–ø–ª–∏–∫:** –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è 2.25M jobs/–¥–µ–Ω—å

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–¥–ª—è production)

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Sentry DSN –≤ Railway:**
   ```bash
   SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
   ```

2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   ```bash
   cd monitoring
   docker-compose up -d
   ```

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Alertmanager —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
   - –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å `monitoring/alertmanager/alertmanager.yml`
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Email/Slack/Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

4. **–û–±–Ω–æ–≤–∏—Ç—å Railway –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
   - Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç `numReplicas: 2` –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –¥–µ–ø–ª–æ–µ

### –í –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è

1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Supabase Connection Pooler** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å rate limiting –¥–ª—è OpenRouter** –ø—Ä–∏ —Ä–µ–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ OpenRouter API –ª–∏–º–∏—Ç–æ–≤**

### –ü—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏

1. **–£–≤–µ–ª–∏—á–∏—Ç—å numReplicas –¥–æ 3-5** –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ 1M jobs/–¥–µ–Ω—å
2. **–†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π** –ø–æ —Ç–∏–ø–∞–º jobs
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—é jobs** –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ö–æ–¥
- `services/worker/src/lib/env.ts` - —É–≤–µ–ª–∏—á–µ–Ω concurrency
- `services/worker/src/index.ts` - –¥–æ–±–∞–≤–ª–µ–Ω—ã retry –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ Sentry
- `services/worker/src/lib/sentry.ts` - –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å Sentry
- `services/worker/src/lib/openrouter-rate-limit.ts` - –Ω–æ–≤—ã–π rate limiter
- `services/worker/src/lib/job-retry.ts` - –Ω–æ–≤—ã–π –º–æ–¥—É–ª—å retry –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `services/worker/src/lib/supabase.ts` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
- `services/worker/package.json` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Sentry
- `services/worker/railway.json` - —É–≤–µ–ª–∏—á–µ–Ω numReplicas

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- `monitoring/prometheus/prometheus.yml` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus
- `monitoring/prometheus/alerts/worker-alerts.yml` - –ø—Ä–∞–≤–∏–ª–∞ –∞–ª–µ—Ä—Ç–æ–≤
- `monitoring/grafana/dashboards/worker-dashboard.json` - –¥–∞—à–±–æ—Ä–¥ Grafana
- `monitoring/alertmanager/alertmanager.yml` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alertmanager
- `monitoring/docker-compose.yml` - Docker Compose –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- `monitoring/README.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `docs/HIGH_LOAD_OPTIMIZATION.md` - –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º

---

## ‚úÖ –ò—Ç–æ–≥

–ü—Ä–æ–µ–∫—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –∫ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ (135k-450k jobs/–¥–µ–Ω—å) —Å–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–º –∑–∞–ø–∞—Å–æ–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã, –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–æ–ª–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –∏ —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä–∏ –¥–∞–ª—å–Ω–µ–π—à–µ–º —Ä–æ—Å—Ç–µ.

**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:** ‚úÖ **100%**

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-26

