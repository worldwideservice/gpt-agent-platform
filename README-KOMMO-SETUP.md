# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Kommo API

## –ü—Ä–æ–±–ª–µ–º–∞
–í –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `KOMMO_TEST_*`, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Kommo CRM.

## –†–µ—à–µ–Ω–∏–µ

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local`
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```bash
# === KOMMO CRM TESTING (DEV ONLY) ===
KOMMO_TEST_ENABLED=1
KOMMO_TEST_DOMAIN=–≤–∞—à-–¥–æ–º–µ–Ω-kommo
KOMMO_TEST_CLIENT_ID=–≤–∞—à-client-id
KOMMO_TEST_CLIENT_SECRET=–≤–∞—à-client-secret
KOMMO_TEST_REDIRECT_URI=http://localhost:3000/api/auth/kommo/callback
KOMMO_TEST_ACCESS_TOKEN=–≤–∞—à-access-token
KOMMO_TEST_REFRESH_TOKEN=–≤–∞—à-refresh-token
```

### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

#### 2.1 –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Kommo
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [https://www.kommo.com/](https://www.kommo.com/)
- –°–æ–∑–¥–∞–π—Ç–µ –∞–∫–∫–∞—É–Ω—Ç –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π

#### 2.2 –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
1. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –∞–∫–∫–∞—É–Ω—Ç–∞ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **"–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"**
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
3. –ü–æ–ª—É—á–∏—Ç–µ **CLIENT_ID** –∏ **CLIENT_SECRET**

#### 2.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞
- **KOMMO_TEST_DOMAIN** - —ç—Ç–æ –ø–æ–¥–¥–æ–º–µ–Ω –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ Kommo
- –ü—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ –≤–∞—à URL `https://mycompany.amocrm.ru`, —Ç–æ –¥–æ–º–µ–Ω –±—É–¥–µ—Ç `mycompany`

#### 2.4 –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –¥–æ—Å—Ç—É–ø–∞
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ OAuth 2.0 flow –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ACCESS_TOKEN –∏ REFRESH_TOKEN:

```javascript
// –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
const getTokens = async () => {
  const response = await fetch(`https://${domain}.amocrm.ru/oauth2/access_token`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      client_id: CLIENT_ID,
      client_secret: CLIENT_SECRET,
      grant_type: 'authorization_code',
      code: AUTHORIZATION_CODE, // –ø–æ–ª—É—á–∏—Ç—å –∏–∑ OAuth flow
      redirect_uri: REDIRECT_URI
    })
  });

  const data = await response.json();
  console.log('Access Token:', data.access_token);
  console.log('Refresh Token:', data.refresh_token);
};
```

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
–ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç:

```bash
npx tsx test-kommo.ts
```

–ï—Å–ª–∏ –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Kommo API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏...
üîß API URL: https://–≤–∞—à-–¥–æ–º–µ–Ω.amocrm.ru/api/v4
1Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...
   –ù–∞–π–¥–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: X
2Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ –≤–æ—Ä–æ–Ω–æ–∫ –ø—Ä–æ–¥–∞–∂...
   –ù–∞–π–¥–µ–Ω–æ –≤–æ—Ä–æ–Ω–æ–∫: X
3Ô∏è‚É£ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —Å–¥–µ–ª–∫–∞–º...
   –í—Å–µ–≥–æ —Å–¥–µ–ª–æ–∫: X
üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
```

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|----------|---------|
| `KOMMO_TEST_ENABLED` | –í–∫–ª—é—á–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (1/0) | `1` |
| `KOMMO_TEST_DOMAIN` | –î–æ–º–µ–Ω Kommo –∞–∫–∫–∞—É–Ω—Ç–∞ | `mycompany` |
| `KOMMO_TEST_CLIENT_ID` | ID –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | `12345678-abcd-...` |
| `KOMMO_TEST_CLIENT_SECRET` | –°–µ–∫—Ä–µ—Ç –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | `abcdef123456...` |
| `KOMMO_TEST_REDIRECT_URI` | URI –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è OAuth | `http://localhost:3000/api/auth/kommo/callback` |
| `KOMMO_TEST_ACCESS_TOKEN` | –¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ | `eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9...` |
| `KOMMO_TEST_REFRESH_TOKEN` | –¢–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | `def50200...` |

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –§–∞–π–ª `.env.local` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è Git (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ `.gitignore`)
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
