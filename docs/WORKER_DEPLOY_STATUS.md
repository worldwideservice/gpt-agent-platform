# ‚úÖ Worker –¥–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω - Redis –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ

**–î–∞—Ç–∞:** 2025-01-26  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–µ–Ω, ‚ö†Ô∏è Redis –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

---

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –£–¥–∞–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è REDIS_URL –∏–∑ Railway

**–î–µ–π—Å—Ç–≤–∏–µ:** –£–¥–∞–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ Railway Dashboard (–±—Ä–∞—É–∑–µ—Ä)

- ‚úÖ –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `REDIS_URL` —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ö–æ—Å—Ç–æ–º `40416.upstash.io` —É–¥–∞–ª–µ–Ω–∞
- ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —É–º–µ–Ω—å—à–∏–ª–æ—Å—å —Å 11 –¥–æ 10
- ‚úÖ Worker —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–ª—å–∫–æ `UPSTASH_REDIS_REST_URL` –∏ `UPSTASH_REDIS_REST_TOKEN`

### 2. –ó–∞–ø—É—â–µ–Ω –Ω–æ–≤—ã–π –¥–µ–ø–ª–æ–π

**–î–µ–π—Å—Ç–≤–∏–µ:** –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∑–∞–ø—É—â–µ–Ω –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ Railway Dashboard

- ‚úÖ –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω ("Deployment successful 3 minutes ago")
- ‚úÖ Worker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ö–æ—Å—Ç: `composed-primate-14678.upstash.io`
- ‚úÖ –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç: `Redis URL constructed from REST URL`

### 3. –ö–æ–¥ Worker –∏—Å–ø—Ä–∞–≤–ª–µ–Ω

**–§–∞–π–ª:** `services/worker/src/index.ts`

- ‚úÖ Worker **–≤—Å–µ–≥–¥–∞** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `UPSTASH_REDIS_REST_URL` –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è Redis URL
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `Redis URL constructed from REST URL (REDIS_URL ignored)`
- ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

---

## ‚ö†Ô∏è –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞

### Redis –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ: —Ç–∞–π–º–∞—É—Ç—ã

**–û—à–∏–±–∫–∞:** `connect ETIMEDOUT`

**–õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:**
```
Redis URL constructed from REST URL
redisHost="composed-primate-14678.upstash.io"
Worker started successfully
[ERRO] Worker error: connect ETIMEDOUT
[WARN] Redis retry attempt 1, delay: 100ms
[WARN] Redis disconnected
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. **–í—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ —Å–µ—Ç–∏** - Upstash –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ —Ä–µ–≥–∏–æ–Ω–∞ Railway
2. **–ü—Ä–æ–±–ª–µ–º–∞ —Å TLS** - Upstash —Ç—Ä–µ–±—É–µ—Ç TLS, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–∞ —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
3. **Firewall/Network** - Railway –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Upstash
4. **Upstash –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω** - —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Upstash

**Health check:**
- ‚ùå Health endpoint –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç (timeout)
- –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ Worker –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Redis –∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é

---

## üîç –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Upstash Redis

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Upstash Redis –¥–æ—Å—Ç—É–ø–µ–Ω
curl -X POST https://composed-primate-14678.upstash.io \
  -H "Authorization: Bearer $UPSTASH_REDIS_REST_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"command": ["PING"]}'
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Worker –¥–µ—Ç–∞–ª—å–Ω–æ

```bash
cd services/worker
railway logs --tail 200 | grep -E "Redis|ETIMEDOUT|connected|ready|error"
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Railway

- ‚úÖ `UPSTASH_REDIS_REST_URL` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º
- ‚úÖ `UPSTASH_REDIS_REST_TOKEN` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º
- ‚úÖ `REDIS_URL` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–¥–∞–ª–µ–Ω (—É–∂–µ —Å–¥–µ–ª–∞–Ω–æ)

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–≥–∏–æ–Ω Railway

- –¢–µ–∫—É—â–∏–π —Ä–µ–≥–∏–æ–Ω: `asia-southeast1-eqsg3a (Legacy)`
- –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–µ–≥–∏–æ–Ω –¥–ª—è –ª—É—á—à–µ–π —Å–≤—è–∑–∏ —Å Upstash

### 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å TLS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- Upstash –∏—Å–ø–æ–ª—å–∑—É–µ—Ç TLS (`rediss://`)
- –ö–æ–¥ —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `tls: { rejectUnauthorized: false }`
- –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

---

## üìä –°—Ç–∞—Ç—É—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏—è |
|-----------|--------|------------|
| –î–µ–ø–ª–æ–π | ‚úÖ –£—Å–ø–µ—à–µ–Ω | Deployment successful 3 minutes ago |
| –ö–æ–¥ Worker | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Redis URL |
| –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Railway | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã | REDIS_URL —É–¥–∞–ª–µ–Ω |
| Redis URL —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `composed-primate-14678.upstash.io` |
| Redis –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ | ‚ö†Ô∏è –¢–∞–π–º–∞—É—Ç—ã | –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ |
| Health check | ‚ùå –ù–µ –æ—Ç–≤–µ—á–∞–µ—Ç | –°–≤—è–∑–∞–Ω–æ —Å Redis –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º |

---

## üéØ –í—ã–≤–æ–¥—ã

1. ‚úÖ **–î–µ–ø–ª–æ–π —É—Å–ø–µ—à–µ–Ω** - –∫–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω
2. ‚úÖ **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã** - REDIS_URL —É–¥–∞–ª–µ–Ω
3. ‚úÖ **Worker –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ö–æ—Å—Ç** - `composed-primate-14678.upstash.io`
4. ‚ö†Ô∏è **Redis –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ** - —Ç–∞–π–º–∞—É—Ç—ã, —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
5. ‚ùå **Health check –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç** - Worker –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –±–µ–∑ Redis

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Upstash Redis –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ç–∏ Railway.

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2025-01-26 12:10 UTC

