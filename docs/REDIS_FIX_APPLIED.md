# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Redis –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

**–î–∞—Ç–∞:** 2025-01-26  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö–æ–¥ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏ –∑–∞–¥–µ–ø–ª–æ–µ–Ω

---

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –ò–∑–º–µ–Ω–µ–Ω –ø–æ—Ä—Ç —Å 6380 –Ω–∞ 6379

**–ü—Ä–æ–±–ª–µ–º–∞:** Worker –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –ø–æ—Ä—Ç 6380, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è Upstash

**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω–µ–Ω –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø–æ—Ä—Ç –Ω–∞ 6379 (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç –¥–ª—è TLS –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Upstash)

```typescript
let redisPort: number = 6379 // Upstash –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 6379 –¥–ª—è TLS (–Ω–µ 6380)
```

### 2. –£–±—Ä–∞–Ω –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π IPv4

**–ü—Ä–æ–±–ª–µ–º–∞:** `family: 4` –º–æ–≥ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–µ—Ç–µ–≤—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö

**–†–µ—à–µ–Ω–∏–µ:** –£–¥–∞–ª–µ–Ω–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ IPv4, —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ –≤—ã–±–µ—Ä–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç

```typescript
// –£–±—Ä–∞–Ω–æ: family: 4
// –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
```

### 3. –£–≤–µ–ª–∏—á–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** `connectTimeout: 30000` (30 —Å–µ–∫—É–Ω–¥) –º–æ–≥ –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º

**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–µ–Ω –¥–æ 60 —Å–µ–∫—É–Ω–¥ –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

```typescript
connectTimeout: 60000, // –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–æ 60 —Å–µ–∫—É–Ω–¥ –¥–ª—è Upstash
```

### 4. –£–ª—É—á—à–µ–Ω–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–∏—à–∫–æ–º –±—ã—Å—Ç—Ä—ã–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –∏ –º–∞–ª–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫

**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞: `times * 200` –≤–º–µ—Å—Ç–æ `times * 100`
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞: 10-15 —Å–µ–∫—É–Ω–¥ –≤–º–µ—Å—Ç–æ 3-5 —Å–µ–∫—É–Ω–¥
- –£–≤–µ–ª–∏—á–µ–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫: –¥–æ 20 –≤–º–µ—Å—Ç–æ 10

```typescript
retryStrategy: (times) => {
  const delay = Math.min(times * 200, 10000) // –î–æ 10 —Å–µ–∫—É–Ω–¥
  if (times > 20) {
    return Math.min(delay, 15000) // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ 15 —Å–µ–∫—É–Ω–¥
  }
  return delay
}
```

---

## üìä –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

**–§–∞–π–ª:** `services/worker/src/index.ts`

### –î–æ:
- –ü–æ—Ä—Ç: `6380`
- `family: 4` (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π IPv4)
- `connectTimeout: 30000` (30 —Å–µ–∫—É–Ω–¥)
- `retryStrategy`: –¥–æ 10 –ø–æ–ø—ã—Ç–æ–∫, –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 5 —Å–µ–∫—É–Ω–¥

### –ü–æ—Å–ª–µ:
- –ü–æ—Ä—Ç: `6379` ‚úÖ
- –ë–µ–∑ `family` (—Å–∏—Å—Ç–µ–º–∞ –≤—ã–±–∏—Ä–∞–µ—Ç) ‚úÖ
- `connectTimeout: 60000` (60 —Å–µ–∫—É–Ω–¥) ‚úÖ
- `retryStrategy`: –¥–æ 20 –ø–æ–ø—ã—Ç–æ–∫, –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 15 —Å–µ–∫—É–Ω–¥ ‚úÖ

---

## üöÄ –î–µ–ø–ª–æ–π

**–°—Ç–∞—Ç—É—Å:** –î–µ–ø–ª–æ–π –∑–∞–ø—É—â–µ–Ω (Building 00:17)

**–ö–æ–º–º–∏—Ç:** `fix: —É–ª—É—á—à–µ–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Upstash Redis - –ø–æ—Ä—Ç 6379, —É–±—Ä–∞–Ω family:4, —É–≤–µ–ª–∏—á–µ–Ω—ã —Ç–∞–π–º–∞—É—Ç—ã`

**GitHub:** Push —É—Å–ø–µ—à–µ–Ω, Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è

---

## ‚è≥ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–µ–ø–ª–æ—è Worker –¥–æ–ª–∂–µ–Ω:
1. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Ä—Ç 6379 –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Upstash
2. ‚úÖ –£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ Redis –±–µ–∑ —Ç–∞–π–º–∞—É—Ç–æ–≤
3. ‚úÖ Health check –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å

---

## üîç –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–µ–ø–ª–æ—è** (–æ–±—ã—á–Ω–æ 2-3 –º–∏–Ω—É—Ç—ã)
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏** - –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å `redisPort=6379` –∏ —É—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å health check** - –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å
4. **–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è** - –≤–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–µ–≥–∏–æ–Ω Railway –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Upstash –∏–∑ —Ä–µ–≥–∏–æ–Ω–∞ `asia-southeast1`

---

**–û–±–Ω–æ–≤–ª–µ–Ω–æ:** 2025-01-26 12:15 UTC

