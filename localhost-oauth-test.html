<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Localhost OAuth Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .code { background: #f0f0f0; padding: 10px; border-radius: 4px; font-family: monospace; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>üîó Localhost OAuth Test for Kommo</h1>

    <p>–ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π redirect URI –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —ç—Ç–æ—Ç localhost –≤–∞—Ä–∏–∞–Ω—Ç:</p>

    <h2>–®–∞–≥ 1: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
    <p>–û—Ç–∫—Ä–æ–π—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ:</p>
    <div class="code">
        https://kommo.com/oauth?client_id=2a5c1463-43dd-4ccc-abd0-79516f785e57&redirect_uri=http%3A%2F%2Flocalhost%3A3000%2Fintegrations%2Fkommo%2Foauth%2Fcallback&scope=crm%3Aread%20crm%3Awrite%20leads%3Aread%20leads%3Awrite%20contacts%3Aread%20contacts%3Awrite%20tasks%3Aread%20tasks%3Awrite&state=localhost_test&response_type=code
    </div>

    <h2>–®–∞–≥ 2: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞</h2>
    <p>–ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤—ã –ø–æ–ø–∞–¥–µ—Ç–µ —Å—é–¥–∞. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL –∏–∑ –∞–¥—Ä–µ—Å–Ω–æ–π —Å—Ç—Ä–æ–∫–∏:</p>
    <input type="text" id="callbackUrl" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ URL —Å—é–¥–∞" style="width: 100%; padding: 8px; margin: 10px 0;">
    <button onclick="processCallback()">üîÑ –û–±—Ä–∞–±–æ—Ç–∞—Ç—å</button>

    <div id="result" style="margin-top: 20px;"></div>

    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ URL (–ø–æ—Å–ª–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        const error = urlParams.get('error');

        if (code) {
            document.getElementById('result').innerHTML = `
                <h3 class="success">‚úÖ –ö–æ–¥ –ø–æ–ª—É—á–µ–Ω!</h3>
                <p><strong>Authorization Code:</strong></p>
                <div class="code">${code}</div>
                <p>–¢–µ–ø–µ—Ä—å –æ–±–º–µ–Ω—è–π—Ç–µ –µ–≥–æ –Ω–∞ —Ç–æ–∫–µ–Ω—ã:</p>
                <div class="code">node exchange-code.js "${code}"</div>
            `;
        } else if (error) {
            document.getElementById('result').innerHTML = `
                <h3 class="error">‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h3>
                <p>Error: ${error}</p>
            `;
        }

        function processCallback() {
            const url = document.getElementById('callbackUrl').value;
            const resultDiv = document.getElementById('result');

            try {
                const urlObj = new URL(url);
                const code = urlObj.searchParams.get('code');
                const error = urlObj.searchParams.get('error');

                if (code) {
                    resultDiv.innerHTML = `
                        <h3 class="success">‚úÖ –ö–æ–¥ –∏–∑–≤–ª–µ—á–µ–Ω!</h3>
                        <p><strong>Authorization Code:</strong></p>
                        <div class="code">${code}</div>
                        <p>–ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:</p>
                        <div class="code">node exchange-code.js "${code}"</div>
                    `;
                } else if (error) {
                    resultDiv.innerHTML = `
                        <h3 class="error">‚ùå –û—à–∏–±–∫–∞ –≤ URL</h3>
                        <p>Error: ${error}</p>
                    `;
                } else {
                    resultDiv.innerHTML = '<p class="error">‚ùå –ö–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ URL</p>';
                }
            } catch (e) {
                resultDiv.innerHTML = `<p class="error">‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç URL: ${e.message}</p>`;
            }
        }
    </script>
</body>
</html>
