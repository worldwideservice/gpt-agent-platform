# –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –¥–µ–ø–ª–æ—è

## ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏–∑ `supabase/migrations/`:
  - [ ] `add_company_knowledge.sql` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞–Ω–∏—è, —Å–∫—Ä–∏–ø—Ç—ã, –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è
  - [ ] `add_agent_pipeline_settings.sql` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ—Ä–æ–Ω–æ–∫ –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç:
  ```sql
  SELECT table_name FROM information_schema.tables 
  WHERE table_schema = 'public' 
  AND table_name IN (
    'agent_pipeline_settings',
    'company_knowledge',
    'sales_scripts',
    'objection_responses',
    'agent_memory'
  );
  ```
- [ ] –°–æ–∑–¥–∞—Ç—å Storage bucket –¥–ª—è —Ñ–∞–π–ª–æ–≤ –∞–≥–µ–Ω—Ç–æ–≤:
  ```sql
  INSERT INTO storage.buckets (id, name, public)
  VALUES ('agent-assets', 'agent-assets', false);
  ```

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### Root (.env.local)
- [ ] `NEXT_PUBLIC_SUPABASE_URL`
- [ ] `NEXT_PUBLIC_SUPABASE_ANON_KEY`
- [ ] `SUPABASE_SERVICE_ROLE_KEY`
- [ ] `SUPABASE_DEFAULT_ORGANIZATION_ID`
- [ ] `OPENROUTER_API_KEY`
- [ ] `NEXT_PUBLIC_APP_URL`
- [ ] `AUTH_SECRET` –∏–ª–∏ `NEXTAUTH_SECRET` (–∫—Ä–∏—Ç–∏—á–Ω–æ!)
- [ ] `BACKEND_API_URL`

#### services/api/.env
- [ ] `SUPABASE_URL`
- [ ] `SUPABASE_SERVICE_ROLE_KEY`
- [ ] `REDIS_URL`
- [ ] `ENCRYPTION_KEY` (32 –±–∞–π—Ç–∞ base64)
- [ ] `OPENROUTER_API_KEY`
- [ ] `KOMMO_OAUTH_REDIRECT_BASE`
- [ ] `KOMMO_WEBHOOK_SECRET`

#### services/worker/.env
- [ ] `SUPABASE_URL`
- [ ] `SUPABASE_SERVICE_ROLE_KEY`
- [ ] `REDIS_URL`
- [ ] `ENCRYPTION_KEY`
- [ ] `OPENROUTER_API_KEY`
- [ ] `JOB_QUEUE_NAME`
- [ ] `JOB_CONCURRENCY`

### 3. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `npm install`
- [ ] –í `services/api`: `npm install`
- [ ] –í `services/worker`: `npm install`
- [ ] –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `cheerio` –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ HTML:
  ```bash
  npm install cheerio @types/cheerio
  ```

### 4. Redis
- [ ] Redis –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π (`REDIS_URL`)
- [ ] –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: `redis-cli ping`

### 5. Supabase Storage
- [ ] Bucket `agent-assets` —Å–æ–∑–¥–∞–Ω
- [ ] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è bucket
- [ ] Service Role –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ bucket

### 6. API Endpoints –ø—Ä–æ–≤–µ—Ä–∫–∞
- [ ] `/api/auth/*` —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] `/api/agents` - —Å–ø–∏—Å–æ–∫ –∞–≥–µ–Ω—Ç–æ–≤
- [ ] `/api/agents/[id]` - CRUD –∞–≥–µ–Ω—Ç–æ–≤
- [ ] `/api/agents/[id]/status` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
- [ ] `/api/agents/[id]/assets` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤
- [ ] `/api/agents/[id]/pipeline-settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ—Ä–æ–Ω–æ–∫
- [ ] `/api/agents/[id]/fields` - –ø–æ–ª—è CRM
- [ ] `/api/agents/[id]/scripts` - —Å–∫—Ä–∏–ø—Ç—ã –ø—Ä–æ–¥–∞–∂
- [ ] `/api/agents/[id]/objections` - –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è
- [ ] `/api/agents/[id]/knowledge` - –∑–Ω–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏
- [ ] `/api/chat` - —á–∞—Ç —Å –∞–≥–µ–Ω—Ç–æ–º

### 7. Worker —Å–µ—Ä–≤–∏—Å
- [ ] Worker –∑–∞–ø—É—â–µ–Ω –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏
- [ ] –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –û—á–µ—Ä–µ–¥—å `agent-jobs` —Å–æ–∑–¥–∞–Ω–∞
- [ ] –¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è

### 8. Frontend –ø—Ä–æ–≤–µ—Ä–∫–∏
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤
- [ ] –û–±—É—á–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ (–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤, –∑–Ω–∞–Ω–∏—è, —Å–∫—Ä–∏–ø—Ç—ã)
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CRM (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤–æ—Ä–æ–Ω–æ–∫)
- [ ] –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞
- [ ] –ß–∞—Ç —Å –∞–≥–µ–Ω—Ç–æ–º

### 9. Security
- [ ] –í—Å–µ `.env` —Ñ–∞–π–ª—ã –≤ `.gitignore`
- [ ] `AUTH_SECRET` —Å–∏–ª—å–Ω—ã–π (32+ —Å–∏–º–≤–æ–ª–∞)
- [ ] `ENCRYPTION_KEY` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
- [ ] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –≤ Supabase –≤–∫–ª—é—á–µ–Ω—ã
- [ ] API endpoints –∑–∞—â–∏—â–µ–Ω—ã middleware

### 10. Performance
- [ ] Database indexes —Å–æ–∑–¥–∞–Ω—ã
- [ ] –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è embeddings —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Redis –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ TODO (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è MVP)

1. **HTML –ø–∞—Ä—Å–∏–Ω–≥** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –±–µ–∑ cheerio
2. **CRM –ø–æ–ª—è** - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–ª—è, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kommo API –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π TODO
3. **Pipeline stage ID –≤ —á–∞—Ç–µ** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–∑ CRM TODO
4. **OpenRouter API –∫–ª—é—á** - –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (—Å–µ–π—á–∞—Å –∏–∑ env)

## üìù –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
3. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é CRM
6. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —á–∞—Ç

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `checkBeforeSending` –≤ `AgentSettings`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã `dealFields` –∏ `contactFields` –≤ `AgentSettings`
- ‚úÖ –í—Å–µ API endpoints –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- ‚úÖ –°—Ç–∞—Ç—É—Å –∞–≥–µ–Ω—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è


