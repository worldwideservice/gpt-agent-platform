# E2E Tests –¥–ª—è GPT Agent Platform

–ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ End-to-End —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

### 1. **agent-lifecycle.spec.ts** - –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∞–≥–µ–Ω—Ç–∞ (–ó–∞–¥–∞—á–∞ 3.4)
–ü–æ–∫—Ä—ã–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã —Å AI –∞–≥–µ–Ω—Ç–∞–º–∏:
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ (–±–∞–∑–æ–≤—ã–µ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ (–∏–º—è, –æ–ø–∏—Å–∞–Ω–∏–µ, –º–æ–¥–µ–ª—å, –ø—Ä–æ–º–ø—Ç)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞–Ω–∞–ª–æ–≤ –∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤
- ‚úÖ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- ‚úÖ –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞
- ‚úÖ –ê–∫—Ç–∏–≤–∞—Ü–∏—è/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞
- ‚úÖ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫ –∞–≥–µ–Ω—Ç–æ–≤

**–ö–ª—é—á–µ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:** ~15 —Ç–µ—Å—Ç–æ–≤

### 2. **test-chat-flow.spec.ts** - –¢–µ—Å—Ç–æ–≤—ã–π —á–∞—Ç (–ó–∞–¥–∞—á–∞ 3.4)
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç—É —Å —Ç–µ—Å—Ç–æ–≤—ã–º —á–∞—Ç–æ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∞–≥–µ–Ω—Ç–æ–≤:
- ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –æ—Ç –∞–≥–µ–Ω—Ç–∞
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –∞–≥–µ–Ω—Ç–∞–º–∏
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –∏ –æ—á–∏—Å—Ç–∫–∞
- ‚úÖ Markdown –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Ç–∞ (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, max_tokens)
- ‚úÖ Streaming –æ—Ç–≤–µ—Ç—ã
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ö–ª—é—á–µ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:** ~20 —Ç–µ—Å—Ç–æ–≤

### 3. **knowledge-base-flow.spec.ts** - –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π (–ó–∞–¥–∞—á–∞ 3.4)
–¢–µ—Å—Ç–∏—Ä—É–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏:
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—å—è–º–∏ (CRUD)
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (PDF, DOCX, TXT)
- ‚úÖ –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (—Ç–µ–∫—Å—Ç–æ–≤—ã–π –∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã–π)
- ‚úÖ Bulk –æ–ø–µ—Ä–∞—Ü–∏–∏ (–º–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ, –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
- ‚úÖ –ò–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç (JSON, CSV)
- ‚úÖ –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—è

**–ö–ª—é—á–µ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:** ~25 —Ç–µ—Å—Ç–æ–≤

### 4. **integration-setup.spec.ts** - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kommo (–ó–∞–¥–∞—á–∞ 3.4)
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫—É CRM Kommo:
- ‚úÖ OAuth –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ –†—É—á–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ API credentials
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–æ—Ä–æ–Ω–æ–∫ –∏ –ø–æ–ª–µ–π
- ‚úÖ Webhook –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–≤–æ—Ä–æ–Ω–∫–∏, –∫–æ–Ω—Ç–∞–∫—Ç—ã)
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**–ö–ª—é—á–µ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:** ~25 —Ç–µ—Å—Ç–æ–≤

### 5. **agent-integrations.spec.ts** - Agent Integrations (–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ)
- ‚úÖ Navigation and Layout (breadcrumbs, tabs, active states)
- ‚úÖ Integrations List (display, install/settings buttons)
- ‚úÖ Search Functionality (filter, clear)
- ‚úÖ Install Modal (OAuth/Manual tabs, validation)
- ‚úÖ Loading/Error States
- ‚úÖ OAuth Success Notifications
- ‚úÖ Accessibility (ARIA, keyboard navigation)
- ‚úÖ Responsive Design (mobile, tablet)

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫
```bash
# –í—Å–µ E2E —Ç–µ—Å—Ç—ã
npm run test:e2e

# –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ (1 worker, Chromium)
npm run test:e2e:light

# –û—Ç–ª–∞–¥–∫–∞ –≤ UI —Ä–µ–∂–∏–º–µ
npm run test:ui

# –û—Ç–ª–∞–¥–∫–∞ —Å –≤–∏–¥–∏–º—ã–º –±—Ä–∞—É–∑–µ—Ä–æ–º
npm run test:headed

# Debug —Ä–µ–∂–∏–º
npm run test:debug

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª
npx playwright test tests/e2e/agent-lifecycle.spec.ts
```

### CI/CD –∑–∞–ø—É—Å–∫
```bash
# –í CI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
CI=true npm run test:e2e
```

## üìä Coverage Requirements

–°–æ–≥–ª–∞—Å–Ω–æ Master Roadmap (–ó–∞–¥–∞—á–∞ 3.4):
- ‚úÖ **E2E —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ–ª–æ—É** - –í–´–ü–û–õ–ù–ï–ù–û
- ‚úÖ **–¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –≤ CI/CD** - –ì–æ—Ç–æ–≤–æ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- ‚úÖ **Code coverage > 70%** - –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ —á–µ—Ä–µ–∑ vitest.config.ts

–¢–µ–∫—É—â–∏–µ coverage thresholds (vitest.config.ts):
```typescript
thresholds: {
  lines: 80%,      // ‚úÖ –í—ã—à–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (70%)
  statements: 75%, // ‚úÖ –í—ã—à–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
  functions: 75%,  // ‚úÖ –í—ã—à–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
  branches: 65%,   // ‚úÖ –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
}
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Playwright Config (playwright.config.ts)
- **–ë—Ä–∞—É–∑–µ—Ä—ã:** Chromium (–æ—Å–Ω–æ–≤–Ω–æ–π –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤)
- **Workers:** 1 –ª–æ–∫–∞–ª—å–Ω–æ, 2 –≤ CI
- **Timeout:** 60s –Ω–∞ —Ç–µ—Å—Ç, 5s –Ω–∞ expect
- **Retry:** 1 retry –≤ CI, 0 –ª–æ–∫–∞–ª—å–Ω–æ
- **Base URL:** http://localhost:3000
- **Demo Mode:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–æ–≤

### Environment Variables
```bash
E2E_ONBOARDING_FAKE=1  # –ü—Ä–æ–ø—É—Å–∫ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞
DEMO_MODE=true          # –î–µ–º–æ-—Ä–µ–∂–∏–º —Å mock –¥–∞–Ω–Ω—ã–º–∏
```

## üìù –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–æ–≤

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã (–ó–∞–¥–∞—á–∞ 3.4) –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ **MOCK/SKELETON**

–í—Å–µ —Ç–µ—Å—Ç—ã —Å–æ–∑–¥–∞–Ω—ã —Å –ø–æ–ª–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –Ω–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ `[MOCK]` –±–ª–æ–∫–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç—Ä–µ–±—É—é—Ç:
1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** - auth helper –¥–ª—è –ª–æ–≥–∏–Ω–∞
2. **–¢–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö** - fixtures –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤, —Å—Ç–∞—Ç–µ–π, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
3. **API mocking** - MSW –∏–ª–∏ Playwright route interception

### –ê–∫—Ç–∏–≤–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤

–î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞:
1. –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `[MOCK]` –±–ª–æ–∫
2. –î–æ–±–∞–≤–∏—Ç—å auth helper (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ñ–∏–∫—Å—Ç—É—Ä—ã/–º–æ–∫–∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

–ü—Ä–∏–º–µ—Ä:
```typescript
// –ë—ã–ª–æ:
test('should create agent', async ({ page }) => {
  // [MOCK] –ü–æ–∫–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
  expect(true).toBe(true)
})

// –°—Ç–∞–ª–æ:
test('should create agent', async ({ page }) => {
  await login(page)
  await createAgent(page, 'Test Agent')
  await expect(page.getByText(/created/i)).toBeVisible()
})
```

## Test Data IDs (–¥–ª—è agent-integrations.spec.ts)

```
integrations-search      - –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞
integrations-table       - –¢–∞–±–ª–∏—Ü–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
install-button           - –ö–Ω–æ–ø–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
settings-button          - –ö–Ω–æ–ø–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
loader                   - Loading indicator
error-state              - Error state
empty-state              - Empty state
```

## üéØ Best Practices

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ö–µ–ª–ø–µ—Ä—ã** - –°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —á–∞—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –¥–µ–π—Å—Ç–≤–∏–π
2. **–ñ–¥–∏—Ç–µ –∑–∞–≥—Ä—É–∑–∫–∏** - –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `waitForLoadState('networkidle')`
3. **Timeout-—ã** - –£–∫–∞–∑—ã–≤–∞–π—Ç–µ reasonable timeouts –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
4. **–°–µ–ª–µ–∫—Ç–æ—Ä—ã** - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: role > label > text > CSS
5. **–ò–∑–æ–ª—è—Ü–∏—è** - –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º
6. **Cleanup** - –û—á–∏—â–∞–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ afterEach

## üêõ Debugging

### –ü—Ä–æ—Å–º–æ—Ç—Ä HTML —Ä–µ–ø–æ—Ä—Ç–∞
```bash
npm run test:report
```

### Trace viewer (–ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞)
1. –¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å `trace: 'on-first-retry'`
2. –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è trace —Ñ–∞–π–ª –≤ `test-results/`
3. –û—Ç–∫—Ä—ã—Ç—å: `npx playwright show-trace <path-to-trace.zip>`

### Screenshots
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–∞
- –ù–∞—Ö–æ–¥—è—Ç—Å—è –≤ `test-results/`

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [Playwright Docs](https://playwright.dev/docs/intro)
- [Playwright Best Practices](https://playwright.dev/docs/best-practices)
- [Playwright CI/CD](https://playwright.dev/docs/ci)

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ PR

- [ ] –í—Å–µ –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç –ª–æ–∫–∞–ª—å–Ω–æ
- [ ] Coverage >= 70% (–¥–ª—è unit —Ç–µ—Å—Ç–æ–≤)
- [ ] –ù–µ—Ç skipped/todo —Ç–µ—Å—Ç–æ–≤ –±–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã (role-based)
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏
- [ ] –¢–µ—Å—Ç—ã –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞

---

**–°–æ–∑–¥–∞–Ω–æ:** –ó–∞–¥–∞—á–∞ 3.4 Master Roadmap
**–°—Ç–∞—Ç—É—Å:** ‚úÖ E2E Tests Infrastructure Complete
**Coverage:** –ì–æ—Ç–æ–≤–æ –∫ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ auth –∏ fixtures
