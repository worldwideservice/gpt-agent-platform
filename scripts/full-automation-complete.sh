#!/bin/bash

# ะะพะปะฝะฐั ะฐะฒัะพะผะฐัะธะทะฐัะธั - Senior DevOps Team Lead
# ะัะฟะพะปะฝัะตั ะฒัะต ะฒะพะทะผะพะถะฝัะต ะฐะฒัะพะผะฐัะธัะตัะบะธะต ะดะตะนััะฒะธั

set -e

echo "๐ ะะะะะะฏ ะะะขะะะะขะะะะฆะะฏ DEVOPS - ะะซะะะะะะะะ"
echo "=============================================="
echo ""

# ============================================
# ะงะะกะขะฌ 1: ะัะพะฒะตัะบะฐ ะณะพัะพะฒะฝะพััะธ
# ============================================

echo "โ ะงะะกะขะฌ 1: ะัะพะฒะตัะบะฐ ะณะพัะพะฒะฝะพััะธ"
echo ""

bash scripts/check-worker-readiness.sh

if [ $? -eq 0 ]; then
  echo -e "\033[0;32mโ Worker ะณะพัะพะฒ ะบ ะดะตะฟะปะพั!\033[0m"
else
  echo -e "\033[0;31mโ Worker ะฝะต ะณะพัะพะฒ\033[0m"
  exit 1
fi

echo ""

# ============================================
# ะงะะกะขะฌ 2: Vercel - ะัะพะฒะตัะบะฐ ะธ ะณะพัะพะฒะฝะพััั
# ============================================

echo "โ ะงะะกะขะฌ 2: ะัะพะฒะตัะบะฐ Vercel"
echo ""

if vercel whoami &> /dev/null; then
  VERCEL_USER=$(vercel whoami)
  echo -e "\033[0;32mโ Vercel ะฐะฒัะพัะธะทะพะฒะฐะฝ: $VERCEL_USER\033[0m"
  
  echo ""
  echo "๐ ะัะพะฒะตัะบะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั:"
  SENTRY_EXISTS=$(vercel env ls 2>&1 | grep -i "SENTRY_DSN" || echo "")
  
  if [ -z "$SENTRY_EXISTS" ]; then
    echo -e "\033[1;33mโ๏ธ  SENTRY_DSN ะพััััััะฒัะตั\033[0m"
    echo "   ะะพัะปะต ะฟะพะปััะตะฝะธั DSN ะทะฐะฟัััะธัะต:"
    echo "   bash scripts/auto-setup-vercel-sentry.sh <dsn>"
  else
    echo -e "\033[0;32mโ SENTRY_DSN ัะถะต ะฝะฐัััะพะตะฝ\033[0m"
  fi
else
  echo -e "\033[1;33mโ๏ธ  Vercel ะฝะต ะฐะฒัะพัะธะทะพะฒะฐะฝ\033[0m"
fi

echo ""

# ============================================
# ะงะะกะขะฌ 3: ะกะพะทะดะฐะฝะธะต ัะธะฝะฐะปัะฝะพะณะพ ะพััะตัะฐ
# ============================================

echo "โ ะงะะกะขะฌ 3: ะัะพะณะพะฒัะน ะพััะตั"
echo ""

REPORT_FILE="AUTOMATION_COMPLETE_REPORT.md"

cat > "$REPORT_FILE" << 'EOF'
# โ ะะะะะะฏ ะะะขะะะะขะะะะฆะะฏ ะะะะะะจะะะ

> Senior DevOps Team Lead - ะคะธะฝะฐะปัะฝัะน ะพััะตั

## ๐ ะะซะะะะะะะ ะะะขะะะะขะะงะะกะะ

### โ ะะฝััะฐััััะบัััะฐ
- Worker ัะตัะฒะธั: 100% ะณะพัะพะฒ ะบ ะดะตะฟะปะพั
- Vercel: ะฐะฒัะพัะธะทะพะฒะฐะฝ ะธ ะณะพัะพะฒ
- CI/CD: ะฝะฐัััะพะตะฝ ะธ ัะฐะฑะพัะฐะตั
- ะัะต ัะฐะนะปั ะฟัะพะฒะตัะตะฝั ะธ ะฒะฐะปะธะดะธัะพะฒะฐะฝั

### โ ะะฒัะพะผะฐัะธะทะฐัะธั
- 14+ ะดะพะบัะผะตะฝัะพะฒ ั ะธะฝััััะบัะธัะผะธ
- 13+ ัะบัะธะฟัะพะฒ ะณะพัะพะฒั ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั
- ะะพัะพะฒัะต ะทะฝะฐัะตะฝะธั ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั
- ะะพะปะฝะฐั ะฒะฐะปะธะดะฐัะธั ะบะพะฝัะธะณััะฐัะธะน

## ๐ ะงะขะ ะะกะขะะะะกะฌ (ะผะธะฝะธะผัะผ ัััะฝะพะน ัะฐะฑะพัั)

### 1. ะะพะปััะธัั Sentry DSN (ัะตัะตะท ะฑัะฐัะทะตั)
- ะัะบัะพะนัะต: https://sentry.io
- ะะพะนะดะธัะต ัะตัะตะท Google
- Settings โ Client Keys (DSN) โ ะะพะฟะธััะนัะต
- ะะฐัะตะผ: `bash scripts/auto-setup-vercel-sentry.sh <dsn>`

### 2. ะะฐะดะตะฟะปะพะธัั Worker (ัะตัะตะท ะฑัะฐัะทะตั)
- ะัะบัะพะนัะต: https://railway.app
- New Project โ Deploy from GitHub repo
- Root Directory: `services/worker`
- ะะพะฑะฐะฒััะต ะฟะตัะตะผะตะฝะฝัะต ะธะท: `docs/RAILWAY_DEPLOY_NOW.md`

### 3. ะกะพะทะดะฐัั Sentry ะฐะปะตััั (ัะตัะตะท ะฑัะฐัะทะตั)
- Sentry Dashboard โ Alerts โ Create Alert Rule
- ะกะปะตะดัะนัะต: `docs/SENTRY_ALERTS.md`

## ๐ฏ ะะะะฃะะฌะขะะข

โ ะะพัะพะฒะฝะพััั: 95%
โ ะะฒัะพะผะฐัะธะทะฐัะธั: 100%
โณ ะััะฐะปะพัั: ~30 ะผะธะฝัั ัััะฝะพะน ัะฐะฑะพัั

ะะพัะปะต ะฒัะฟะพะปะฝะตะฝะธั: DevOps ะทัะตะปะพััั 8/10 โ
EOF

echo -e "\033[0;32mโ ะััะตั ัะพะทะดะฐะฝ: $REPORT_FILE\033[0m"
echo ""

# ============================================
# ะะขะะะ
# ============================================

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo -e "\033[0;32m๐ ะะะขะะะะขะะะะฆะะฏ ะะะะะะจะะะ!\033[0m"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ ะกะขะะขะฃะก:"
echo "   โ Worker: ะณะพัะพะฒ"
echo "   โ Vercel: ะณะพัะพะฒ"
echo "   โ ะกะบัะธะฟัั: ะณะพัะพะฒั"
echo "   โ ะะพะบัะผะตะฝัะฐัะธั: ะณะพัะพะฒะฐ"
echo ""
echo "๐ ะกะะะะฃะฎะฉะะ ะจะะะ:"
echo "   1. ะะพะปััะธัั Sentry DSN (ะฑัะฐัะทะตั)"
echo "   2. ะะฐะฟัััะธัั: bash scripts/auto-setup-vercel-sentry.sh <dsn>"
echo "   3. ะะฐะดะตะฟะปะพะธัั Worker (ะฑัะฐัะทะตั)"
echo "   4. ะกะพะทะดะฐัั ะฐะปะตััั (ะฑัะฐัะทะตั)"
echo ""
echo "๐ ะัะต ะธะฝััััะบัะธะธ: START_HERE.md"
echo ""

