#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ–ø–ª–æ—è Worker –Ω–∞ Railway

set -e

echo "üöÄ –î–µ–ø–ª–æ–π Worker –Ω–∞ Railway..."
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Railway CLI
if ! command -v railway &> /dev/null; then
    echo "‚ùå Railway CLI –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    echo ""
    echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Railway CLI..."
    npm install -g @railway/cli
    echo ""
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
echo "üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Railway..."
if ! railway whoami &> /dev/null; then
    echo "‚ö†Ô∏è  –ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ Railway"
    echo "üîë –í–æ–π–¥–∏—Ç–µ –≤ Railway..."
    railway login
    echo ""
fi

# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é Worker
cd "$(dirname "$0")/../services/worker"

echo "üì¶ –î–µ–ø–ª–æ–π Worker..."
echo ""

# –î–µ–ø–ª–æ–π
railway up

echo ""
echo "‚úÖ –î–µ–ø–ª–æ–π –∑–∞–ø—É—â–µ–Ω!"
echo ""
echo "üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞..."
echo "–ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:"
echo "  ./scripts/check-worker-health.sh"
echo ""

