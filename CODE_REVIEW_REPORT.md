# –û—Ç—á–µ—Ç –æ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–æ–¥–∞ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. **AgentSettings —Ç–∏–ø–∏–∑–∞—Ü–∏—è**
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `checkBeforeSending?: boolean`
   - ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã `dealFields?: string[]` –∏ `contactFields?: string[]`
   - –§–∞–π–ª: `types/index.ts`

2. **–í—Å–µ API endpoints —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ**
   - ‚úÖ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤
   - ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–º –∞–≥–µ–Ω—Ç–∞
   - ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
   - ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏—è–º–∏, —Å–∫—Ä–∏–ø—Ç–∞–º–∏, –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è–º–∏
   - ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ—Ä–æ–Ω–æ–∫ –∏ –ø–æ–ª–µ–π CRM

3. **–°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö –≤–∞–ª–∏–¥–Ω–∞**
   - ‚úÖ –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
   - ‚úÖ –ò–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã
   - ‚úÖ Foreign keys –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

## ‚ö†Ô∏è –ù–µ –∫—Ä–∏—Ç–∏—á–Ω–æ (–º–æ–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–∑–∂–µ)

### 1. HTML –ø–∞—Ä—Å–∏–Ω–≥
**–§–∞–π–ª:** `lib/services/file-parser.ts:87`
- –°–µ–π—á–∞—Å: —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ —á–µ—Ä–µ–∑ regex
- TODO: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `cheerio` –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (—Ç–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç)

### 2. CRM –ø–æ–ª—è –∏–∑ API
**–§–∞–π–ª:** `components/crm/DealContactFieldsSelector.tsx:30`
- –°–µ–π—á–∞—Å: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ–ª—è –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω—ã
- TODO: –ø–æ–ª—É—á–∞—Ç—å –ø–æ–ª—è –∏–∑ Kommo API —á–µ—Ä–µ–∑ `/api/crm/kommo/fields`
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (–¥–ª—è production –ª—É—á—à–µ –ø–æ–ª—É—á–∞—Ç—å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)

### 3. Pipeline stage ID –≤ —á–∞—Ç–µ
**–§–∞–π–ª:** `app/api/chat/route.ts:90`
- –°–µ–π—á–∞—Å: –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- TODO: –ø–æ–ª—É—á–∏—Ç—å –∏–∑ CRM —Å–¥–µ–ª–∫–∏ —á–µ—Ä–µ–∑ conversation metadata
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π (—É–ª—É—á—à–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è –∞–≥–µ–Ω—Ç–∞)

### 4. OpenRouter API –∫–ª—é—á –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
**–§–∞–π–ª—ã:** 
- `lib/services/llm.ts:49`
- `lib/services/embeddings.ts:16`
- –°–µ–π—á–∞—Å: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–π `process.env.OPENROUTER_API_KEY`
- TODO: –ø–æ–ª—É—á–∞—Ç—å –∏–∑ `organizations.settings.openrouter_api_key`
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (–¥–ª—è MVP –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ env)

## üìã –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```sql
-- –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
\i supabase/migrations/add_company_knowledge.sql
\i supabase/migrations/add_agent_pipeline_settings.sql

-- –°–æ–∑–¥–∞—Ç—å Storage bucket
INSERT INTO storage.buckets (id, name, public)
VALUES ('agent-assets', 'agent-assets', false);
```

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
**–ö—Ä–∏—Ç–∏—á–Ω–æ:**
- `AUTH_SECRET` –∏–ª–∏ `NEXTAUTH_SECRET` - –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è NextAuth
- `ENCRYPTION_KEY` - 32 –±–∞–π—Ç–∞ base64 –¥–ª—è —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è CRM —Å–µ–∫—Ä–µ—Ç–æ–≤
- `OPENROUTER_API_KEY` - –¥–ª—è —Ä–∞–±–æ—Ç—ã LLM
- `SUPABASE_SERVICE_ROLE_KEY` - –¥–ª—è backend –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
npm run check:env
```

### 3. Redis
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ Redis –∑–∞–ø—É—â–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- `REDIS_URL` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞
- [ ] –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞
- [ ] –û–±—É—á–µ–Ω–∏–µ (–∑–Ω–∞–Ω–∏—è, —Å–∫—Ä–∏–ø—Ç—ã, –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è)
- [ ] –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è CRM –≤–æ—Ä–æ–Ω–æ–∫
- [ ] –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∞–≥–µ–Ω—Ç–∞
- [ ] –ß–∞—Ç —Å –∞–≥–µ–Ω—Ç–æ–º

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã)

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `checkBeforeSending` –≤ —Ç–∏–ø–∞—Ö
**–°—Ç–∞—Ç—É—Å:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
**–§–∞–π–ª:** `types/index.ts`
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ –≤ `AgentSettings`

### ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `dealFields` –∏ `contactFields` –≤ —Ç–∏–ø–∞—Ö
**–°—Ç–∞—Ç—É—Å:** –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
**–§–∞–π–ª:** `types/index.ts`
**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –≤ `AgentSettings`

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–õ–∏–Ω—Ç–µ—Ä –æ—à–∏–±–∫–∏:** 0
- **TypeScript –æ—à–∏–±–∫–∏:** 0
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ TODO:** 0 (–≤—Å–µ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
- **API endpoints:** –í—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç
- **–ú–∏–≥—Ä–∞—Ü–∏–∏:** 2 (–æ–±–∞ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è)

## üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–µ–ø–ª–æ—é

**–û—Ü–µ–Ω–∫–∞:** 95% –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

**–û—Å—Ç–∞–ª–æ—Å—å:**
1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å Redis –∏ Worker
4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ production –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —á–µ–∫–ª–∏—Å—Ç–∞ –≤ `DEPLOYMENT_CHECKLIST.md`**


