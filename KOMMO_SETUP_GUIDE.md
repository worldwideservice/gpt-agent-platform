# Пошаговая инструкция подключения к Kommo CRM

## Шаг 1: Получение токена доступа в Kommo

### 1.1 Вход в Kommo CRM
1. Откройте ваш аккаунт Kommo CRM
2. Войдите в систему с вашими учетными данными

### 1.2 Создание приложения
1. Перейдите в **Настройки** → **Интеграции** → **API**
2. Нажмите **"Создать приложение"** или **"Добавить приложение"**
3. Заполните данные:
   - **Название**: GPT Agent Integration
   - **Описание**: Интеграция с GPT Agent для автоматизации
   - **Redirect URI**: `https://gpt-agent-platform.vercel.app/api/crm/kommo/callback`

### 1.3 Получение токенов
1. После создания приложения вы получите:
   - **Client ID** (ID приложения)
   - **Client Secret** (Секретный ключ)
2. Скопируйте эти данные

## Шаг 2: Настройка переменных окружения

### 2.1 Локальная разработка
Создайте файл `.env.local` в корне проекта:
```env
KOMMO_CLIENT_ID=ваш_client_id_здесь
KOMMO_CLIENT_SECRET=ваш_client_secret_здесь
KOMMO_REDIRECT_URI=http://localhost:3000/api/crm/kommo/callback
NEXT_PUBLIC_API_URL=http://localhost:3000
```

### 2.2 Продакшн (Vercel)
1. Зайдите в панель Vercel
2. Перейдите в **Settings** → **Environment Variables**
3. Добавьте переменные:
   - `KOMMO_CLIENT_ID` = ваш_client_id
   - `KOMMO_CLIENT_SECRET` = ваш_client_secret
   - `KOMMO_REDIRECT_URI` = https://gpt-agent-platform.vercel.app/api/crm/kommo/callback
   - `NEXT_PUBLIC_API_URL` = https://gpt-agent-platform.vercel.app

## Шаг 3: Получение токена доступа

### 3.1 Через OAuth (Рекомендуется)
1. Перейдите на страницу **Интеграции** в приложении
2. Нажмите **"Подключить CRM"**
3. Выберите **Kommo CRM**
4. Нажмите **"Подключить"** (OAuth)
5. Войдите в ваш аккаунт Kommo
6. Разрешите доступ приложению

### 3.2 Через токен (Для тестирования)
1. В Kommo перейдите в **Настройки** → **Интеграции** → **API**
2. Найдите ваше приложение
3. Скопируйте **Access Token**
4. В приложении выберите **"Тестовое подключение"**
5. Вставьте токен и нажмите **"Тест"**

## Шаг 4: Проверка подключения

### 4.1 Проверка синхронизации
1. После подключения нажмите **"Синхронизировать"**
2. Проверьте результаты:
   - ✅ **Воронки**: должны показать ваши воронки продаж
   - ✅ **Каналы**: Email, Телефон, Чат
   - ✅ **Контакты**: ваши контакты из CRM
   - ✅ **Сделки**: активные сделки

### 4.2 Отладка проблем
Если данные не подтягиваются:
1. Проверьте права доступа в Kommo
2. Убедитесь, что токен действителен
3. Проверьте логи в консоли браузера
4. Проверьте переменные окружения

## Шаг 5: Настройка агента

### 5.1 Использование данных CRM
1. Перейдите в **Агенты** → **Редактировать агента**
2. Вкладка **"Сделки и контакты"**
3. Выберите активные воронки
4. Настройте этапы сделок
5. Сохраните настройки

## Возможные проблемы и решения

### Проблема: "Токен недействителен"
**Решение**: 
- Проверьте правильность токена
- Убедитесь, что токен не истек
- Создайте новый токен в Kommo

### Проблема: "Недостаточно прав доступа"
**Решение**:
- Проверьте права приложения в Kommo
- Убедитесь, что включены права на чтение данных

### Проблема: "API ошибка 429"
**Решение**:
- Превышен лимит запросов
- Подождите несколько минут и попробуйте снова

### Проблема: "Данные не синхронизируются"
**Решение**:
- Проверьте подключение к интернету
- Проверьте переменные окружения
- Проверьте логи в консоли разработчика
