# ‚úÖ Railway Worker - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã—Ö –ø—É—Ç–µ–π –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –∏–º–ø–æ—Ä—Ç–æ–≤

## üîß –ü—Ä–æ–±–ª–µ–º–∞

–û—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ (`../lib/`, `../../lib/`) –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏ –Ω–∞–¥–µ–∂–Ω–æ –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ–º –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ —á–µ—Ä–µ–∑ `import.meta.url` –∏ `fileURLToPath` –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

### –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

**1. `services/worker/src/tasks/index.ts` (webhook:retry):**

```typescript
'webhook:retry': async (payload: { eventId: string; retryCount: number }) => {
  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É—Ç—å –∫ —Ç–µ–∫—É—â–µ–º—É —Ñ–∞–π–ª—É (dist/tasks/index.js)
  const currentFile = fileURLToPath(import.meta.url)
  const currentDir = dirname(currentFile)
  
  // –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø—É—Ç–µ–π
  const paths = [
    resolve(currentDir, '../lib/services/webhook-processor'), // services/worker/dist/lib/
    resolve(currentDir, '../../lib/services/webhook-processor'), // services/worker/lib/
    resolve(process.cwd(), 'lib/services/webhook-processor'), // /app/lib/
    resolve(process.cwd(), 'services/worker/lib/services/webhook-processor'), // /app/services/worker/lib/
  ]
  
  // –ü—Ä–æ–±—É–µ–º –∫–∞–∂–¥—ã–π –ø—É—Ç—å –¥–æ –ø–µ—Ä–≤–æ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ
  for (const libPath of paths) {
    try {
      const moduleUrl = pathToFileURL(libPath + '.js').href
      const module = await import(moduleUrl)
      processWebhookEvent = module.processWebhookEvent
      console.log(`‚úÖ Successfully imported webhook-processor from: ${libPath}`)
      break
    } catch (error) {
      // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø—É—Ç–∏
    }
  }
}
```

**2. `services/worker/src/tasks/heavy-processing.ts` (getUserTier):**

–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è `UserRepository` —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –ø—É—Ç–µ–π.

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –ê–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–µ–∫—É—â–µ–π —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
2. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç, –∫–∞–∫–æ–π –ø—É—Ç—å —Å—Ä–∞–±–æ—Ç–∞–ª
3. **Fallback**: –ü—Ä–æ–±—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø—É—Ç–µ–π –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: –†–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö (–ª–æ–∫–∞–ª—å–Ω–æ, Docker, Railway)

### –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏

```
ESM dist/index.js 49.54 KB
ESM ‚ö°Ô∏è Build success in 37ms
DTS ‚ö°Ô∏è Build success in 3815ms
```

## üìã –°—Ç–∞—Ç—É—Å

- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø—É—à–µ–Ω—ã –≤ GitHub
- ‚úÖ –°–±–æ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ
- ‚è≥ Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç –Ω–æ–≤—ã–π –¥–µ–ø–ª–æ–π

## üöÄ –û–∂–∏–¥–∞–Ω–∏–µ

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è –ª–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç:
- –ö–∞–∫–æ–π –ø—É—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ `webhook-processor`
- –ö–∞–∫–æ–π –ø—É—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ `UserRepository`
- –≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –≤ production

---

**–í—Ä–µ–º—è:** 2025-01-26  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –¥–µ–ø–ª–æ—è —Å –∞–±—Å–æ–ª—é—Ç–Ω—ã–º–∏ –ø—É—Ç—è–º–∏


