# üìä –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–µ–∫—Ç–∞ GPT Agent Platform

**–î–∞—Ç–∞:** 2025-01-02  
**–í–µ—Ä—Å–∏—è:** 1.0.5

---

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** (`/register`) - –ø–æ–ª–Ω–∞—è —Ñ–æ—Ä–º–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- ‚úÖ **–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É** (`/login`) - NextAuth credentials
- ‚úÖ **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è** (`/reset-password`) - –∑–∞–ø—Ä–æ—Å –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- ‚úÖ **NextAuth + Supabase** - JWT —Å–µ—Å—Å–∏–∏
- ‚úÖ **–ú—É–ª—å—Ç–∏–∞—Ä–µ–Ω–¥–Ω–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π (organizations)
- ‚úÖ **–†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - owner, member
- ‚úÖ **–ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã** - —á–µ—Ä–µ–∑ `(protected)` layout

### üìÑ –°—Ç—Ä–∞–Ω–∏—Ü—ã

#### –ü—É–±–ª–∏—á–Ω—ã–µ (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏):
- ‚úÖ **Landing Page** (`/`) - –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –≤—Ö–æ–¥–∞
- ‚úÖ **–õ–æ–≥–∏–Ω** (`/login`) - —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
- ‚úÖ **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** (`/register`) - —Ñ–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ **–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è** (`/reset-password/request` –∏ `/reset-password/[token]`)

#### –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ:
- ‚úÖ **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞** (`/platform`) - –ø—É—Å—Ç–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞, –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ

### üîå API Endpoints

**–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è:**
- `/api/auth/register` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `/api/auth/reset-password/request` - –∑–∞–ø—Ä–æ—Å —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è
- `/api/auth/reset-password/confirm` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–±—Ä–æ—Å–∞
- `/api/auth/get-tenant-redirect` - –ø–æ–ª—É—á–µ–Ω–∏–µ tenant-id –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞

**–ê–≥–µ–Ω—Ç—ã** (—á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ, –Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É–¥–∞–ª–µ–Ω—ã):
- `/api/agents` - CRUD –∞–≥–µ–Ω—Ç–æ–≤
- `/api/agents/[id]/...` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≥–µ–Ω—Ç–æ–≤

**–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π** (API –µ—Å—Ç—å, —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É–¥–∞–ª–µ–Ω—ã):
- `/api/knowledge-base/categories` - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `/api/knowledge-base/articles` - —Å—Ç–∞—Ç—å–∏

**CRM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:**
- `/api/integrations/kommo/oauth/start` - –Ω–∞—á–∞–ª–æ OAuth
- `/api/integrations/kommo/oauth/callback` - OAuth callback
- `/api/crm/webhook` - webhook –æ—Ç Kommo
- `/api/crm/kommo` - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å Kommo

**–î—Ä—É–≥–æ–µ:**
- `/api/health` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
- `/api/health/ready` - –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞
- `/api/notifications` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `/api/organization/settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- `/api/subscriptions` - –ø–æ–¥–ø–∏—Å–∫–∏ (Stripe)

### üèóÔ∏è –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- ‚úÖ **Supabase** - PostgreSQL + pgvector + Storage
- ‚úÖ **Redis** - –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—á–µ—Ä–µ–¥–∏ (BullMQ)
- ‚úÖ **OpenRouter** - LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä (100+ –º–æ–¥–µ–ª–µ–π)
- ‚úÖ **Next.js 14** - App Router
- ‚úÖ **TypeScript** - —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- ‚úÖ **Tailwind CSS** - —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ **Sentry** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫

### üé® UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ **Button, Input, Card** - –±–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ **Dialog, Modal, Popover** - –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
- ‚úÖ **Header, Sidebar** - layout –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- ‚úÖ **Toast notifications** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ **Dark/Light —Ç–µ–º—ã** - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º

### üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ú–∏–≥—Ä–∞—Ü–∏–∏ Supabase** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ **RLS (Row Level Security)** - –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **pgvector** - –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ embeddings
- ‚úÖ **–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –∞–≥–µ–Ω—Ç—ã** - –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

---

## üó∫Ô∏è –ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è, —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è

### 1. **Middleware (`middleware.ts`)** - –ü—Ä–æ–≤–µ—Ä–∫–∞ –î–û –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
```typescript
// middleware.ts
- –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã –∏ API —Ä–æ—É—Ç—ã
- –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–µ –ø—É—Ç–∏: /login, /register, /reset-password, /, /pricing, /demo, /support
- –î–ª—è –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö –ø—É—Ç–µ–π - —Ä–µ–¥–∏—Ä–µ–∫—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ layout
```

**–§–∞–π–ª:** `middleware.ts`  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** –ë–∞–∑–æ–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤, –ø—Ä–æ–ø—É—Å–∫ —Å—Ç–∞—Ç–∏–∫–∏ –∏ –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü

---

### 2. **NextAuth –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (`auth.ts`)** - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```typescript
// auth.ts
pages: {
  signIn: '/login',  // –ö—É–¥–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç—å –µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
}
```

**–§–∞–π–ª:** `auth.ts`  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:** 
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ª–æ–≥–∏–Ω–∞
- –û–±—Ä–∞–±–æ—Ç–∫–∞ credentials –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ —Å `orgId`
- –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –µ—Å–ª–∏ –Ω–µ—Ç

---

### 3. **Protected Layout (`app/(protected)/layout.tsx`)** - –ó–∞—â–∏—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
```typescript
// app/(protected)/layout.tsx
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–µ—Å—Å–∏—é: if (!session?.user?.orgId) redirect("/login")
- –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
- –ù–∞—Ö–æ–¥–∏—Ç –∞–∫—Ç–∏–≤–Ω—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
- –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç HeaderWithSidebar
```

**–§–∞–π–ª:** `app/(protected)/layout.tsx`  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –≤ `(protected)`
- ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login` –µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ layout —Å Header –∏ Sidebar

---

### 4. **Login Client (`app/(auth)/login/LoginClient.tsx`)** - –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
```typescript
// app/(auth)/login/LoginClient.tsx
1. signIn('credentials', { email, password, redirect: false })
2. –û–∂–∏–¥–∞–Ω–∏–µ 1000ms –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏: fetch('/api/auth/session')
4. –ü–æ–ª—É—á–µ–Ω–∏–µ tenant-id: fetch('/api/auth/get-tenant-redirect')
5. –†–µ–¥–∏—Ä–µ–∫—Ç: window.location.href = `/manage/${tenantId}`
```

**–§–∞–π–ª:** `app/(auth)/login/LoginClient.tsx` (—Å—Ç—Ä–æ–∫–∏ 35-117)  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
- ‚úÖ –í—ã–∑–æ–≤ `signIn()` –∏–∑ NextAuth
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ tenant-id —á–µ—Ä–µ–∑ API
- ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/manage/[tenantId]` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `window.location.href` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞)

---

### 5. **Get Tenant Redirect API (`app/api/auth/get-tenant-redirect/route.ts`)** - –ü–æ–ª—É—á–µ–Ω–∏–µ tenant-id
```typescript
// app/api/auth/get-tenant-redirect/route.ts
- –í—ã–∑—ã–≤–∞–µ—Ç getTenantIdFromSession()
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç { success: true, tenantId: "..." }
```

**–§–∞–π–ª:** `app/api/auth/get-tenant-redirect/route.ts`  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ tenant-id –∏–∑ —Å–µ—Å—Å–∏–∏
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞

---

### 6. **Get Tenant ID Utility (`lib/utils/getTenantRedirect.ts`)** - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è tenant-id
```typescript
// lib/utils/getTenantRedirect.ts
getTenantIdFromSession():
  1. –ü–æ–ª—É—á–∞–µ—Ç —Å–µ—Å—Å–∏—é —á–µ—Ä–µ–∑ auth()
  2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç session.user.orgId
  3. –ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
  4. –ù–∞—Ö–æ–¥–∏—Ç –∞–∫—Ç–∏–≤–Ω—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é
  5. –ü–æ–ª—É—á–∞–µ—Ç/–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç slug
  6. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç tenant-id: {numericId}-{slug}

redirectToTenantPath(newPath, fallbackPath):
  - –ü–æ–ª—É—á–∞–µ—Ç tenant-id
  - –†–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ /manage/${tenantId}${newPath}
```

**–§–∞–π–ª:** `lib/utils/getTenantRedirect.ts`  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ tenant-id –∏–∑ —Å–µ—Å—Å–∏–∏
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è slug –µ—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- ‚úÖ Server-side —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã –Ω–∞ –ø—É—Ç–∏ —Å tenant-id
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ —Å—Ç–∞—Ä—ã—Ö –ø—É—Ç–µ–π –Ω–∞ –Ω–æ–≤—ã–µ

---

### 7. **Landing Page Client (`app/LandingPageClient.tsx`)** - –†–µ–¥–∏—Ä–µ–∫—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö
```typescript
// app/LandingPageClient.tsx
useEffect(() => {
  if (status === 'authenticated' && session?.user) {
    router.replace('/agents')  // ‚Üê –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç–∞—Ä—ã–π –ø—É—Ç—å (—É—Å—Ç–∞—Ä–µ–ª)
  }
}, [session, status, router])
```

**–§–∞–π–ª:** `app/LandingPageClient.tsx` (—Å—Ç—Ä–æ–∫–∏ 15-21)  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚ö†Ô∏è –†–µ–¥–∏—Ä–µ–∫—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ `/agents` (—Å—Ç–∞—Ä—ã–π –ø—É—Ç—å, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –Ω–∞ –Ω–æ–≤—ã–π –ø—É—Ç—å `/manage/[tenantId]` –∏–ª–∏ —É–±—Ä–∞—Ç—å

---

### 8. **Register Client (`app/(auth)/register/RegisterClient.tsx`)** - –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
```typescript
// app/(auth)/register/RegisterClient.tsx
router.push('/login?registered=true')
```

**–§–∞–π–ª:** `app/(auth)/register/RegisterClient.tsx` (—Å—Ç—Ä–æ–∫–∞ 73)  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `registered=true`
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

---

### 9. **Reset Password (`app/(auth)/reset-password/[token]/ConfirmForm.tsx`)** - –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞
```typescript
// app/(auth)/reset-password/[token]/ConfirmForm.tsx
<Link href="/login">
  <Button>–í–µ—Ä–Ω—É—Ç—å—Å—è –∫–æ –≤—Ö–æ–¥—É</Button>
</Link>
```

**–§–∞–π–ª:** `app/(auth)/reset-password/[token]/ConfirmForm.tsx`  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è - —Å—Å—ã–ª–∫–∞ –Ω–∞ `/login`

---

### 10. **OAuth Callback (`app/api/integrations/kommo/oauth/callback/route.ts`)** - –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ OAuth
```typescript
// –í–µ—Ä–æ—è—Ç–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ OAuth
// –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
```

**–§–∞–π–ª:** `app/api/integrations/kommo/oauth/callback/route.ts`  
**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ OAuth callback –æ—Ç Kommo
- ‚úÖ –í–µ—Ä–æ—è—Ç–Ω–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

---

## üìç –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ Next.js

### App Router —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
```
app/
‚îú‚îÄ‚îÄ page.tsx                    ‚Üí / (Landing Page)
‚îú‚îÄ‚îÄ LandingPageClient.tsx       ‚Üí Client –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –ª—ç–Ω–¥–∏–Ω–≥–∞
‚îú‚îÄ‚îÄ (auth)/                     ‚Üí –ì—Ä—É–ø–ø–∞ –ø—É–±–ª–∏—á–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (–Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ URL)
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx             ‚Üí Layout –¥–ª—è auth —Å—Ç—Ä–∞–Ω–∏—Ü
‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx           ‚Üí /login
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ LoginClient.tsx    ‚Üí Client –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ª–æ–≥–∏–Ω–∞
‚îÇ   ‚îú‚îÄ‚îÄ register/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx           ‚Üí /register
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ RegisterClient.tsx ‚Üí Client –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ reset-password/
‚îÇ       ‚îú‚îÄ‚îÄ request/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx       ‚Üí /reset-password/request
‚îÇ       ‚îî‚îÄ‚îÄ [token]/
‚îÇ           ‚îî‚îÄ‚îÄ page.tsx       ‚Üí /reset-password/[token]
‚îî‚îÄ‚îÄ (protected)/                ‚Üí –ì—Ä—É–ø–ø–∞ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (–Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ URL)
    ‚îú‚îÄ‚îÄ layout.tsx             ‚Üí –ó–∞—â–∏—â–µ–Ω–Ω—ã–π layout (–ø—Ä–æ–≤–µ—Ä–∫–∞ auth)
    ‚îî‚îÄ‚îÄ page.tsx               ‚Üí /platform (–ø—É—Å—Ç–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
```

---

## üîÑ Flow –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—Ç–µ–∫—É—â–∏–π)

### 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ `/` (Landing Page)
- –í–∏–¥–∏—Ç –∫–Ω–æ–ø–∫–∏ "–í–æ–π—Ç–∏" –∏ "–ù–∞—á–∞—Ç—å"
- –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/agents` (—É—Å—Ç–∞—Ä–µ–ª, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å)

### 2. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ `/login`
- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
- –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ `signIn()`:
  1. –û–∂–∏–¥–∞–Ω–∏–µ 1000ms
  2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ `/api/auth/session`
  3. –ü–æ–ª—É—á–µ–Ω–∏–µ tenant-id —á–µ—Ä–µ–∑ `/api/auth/get-tenant-redirect`
  4. –†–µ–¥–∏—Ä–µ–∫—Ç: `window.location.href = /manage/${tenantId}`

### 3. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/manage/[tenantId]` (–µ—Å–ª–∏ –±—ã —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–ª–∞)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ `(protected)/layout.tsx`:
  - –ù–µ—Ç —Å–µ—Å—Å–∏–∏ ‚Üí `redirect("/login")`
  - –ï—Å—Ç—å —Å–µ—Å—Å–∏—è ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É

### 4. –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- ‚úÖ `/platform` - –ø—É—Å—Ç–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞, –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- ‚ö†Ô∏è –ü–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç –∏–¥–µ—Ç –Ω–∞ `/manage/${tenantId}`, –Ω–æ —ç—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚ö†Ô∏è –ù—É–∂–Ω–æ –ª–∏–±–æ —Å–æ–∑–¥–∞—Ç—å `/manage/[tenantId]`, –ª–∏–±–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/platform`

---

## üìù –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-----------|
| `middleware.ts` | –ë–∞–∑–æ–≤–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è, –ø—Ä–æ–ø—É—Å–∫ —Å—Ç–∞—Ç–∏–∫–∏ |
| `auth.ts` | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ NextAuth, —Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ |
| `app/(protected)/layout.tsx` | –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login` |
| `app/(auth)/login/LoginClient.tsx` | –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ –Ω–∞ `/manage/${tenantId}` |
| `app/api/auth/get-tenant-redirect/route.ts` | API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è tenant-id |
| `lib/utils/getTenantRedirect.ts` | –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å tenant-id |
| `app/LandingPageClient.tsx` | –†–µ–¥–∏—Ä–µ–∫—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| `ROUTING_GUIDE.md` | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ |
| `docs/NAVIGATION_FLOW.md` | –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è flow –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ |

---

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã –∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è

### 1. –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç –∏–¥–µ—Ç –Ω–∞ `/manage/${tenantId}`, –Ω–æ —ç—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ
- **–¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:** `/platform` - –ø—É—Å—Ç–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- **–†–µ—à–µ–Ω–∏–µ:** –õ–∏–±–æ —Å–æ–∑–¥–∞—Ç—å `/manage/[tenantId]`, –ª–∏–±–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/platform`

### 2. Landing Page —Ä–µ–¥–∏—Ä–µ–∫—Ç
- **–ü—Ä–æ–±–ª–µ–º–∞:** –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç—è—Ç—Å—è –Ω–∞ `/agents` (—Å—Ç–∞—Ä—ã–π –ø—É—Ç—å)
- **–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞ –Ω–æ–≤—ã–π –ø—É—Ç—å –∏–ª–∏ —É–±—Ä–∞—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç

### 3. –°—Ç–∞—Ä—ã–µ –ø—É—Ç–∏
- **–ü—Ä–æ–±–ª–µ–º–∞:** –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —É–ø–æ–º–∏–Ω–∞—é—Ç—Å—è —Å—Ç–∞—Ä—ã–µ –ø—É—Ç–∏ (`/agents`, `/chat`, `/knowledge-base`)
- **–†–µ—à–µ–Ω–∏–µ:** –≠—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —É–¥–∞–ª–µ–Ω—ã, –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (`/platform`)
2. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤ `LandingPageClient.tsx`
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (`PAGES_LIST.md`, `ROUTING_GUIDE.md`)

### –í –±—É–¥—É—â–µ–º:
1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É `/manage/[tenantId]` –µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –º—É–ª—å—Ç–∏–∞—Ä–µ–Ω–¥–Ω–æ—Å—Ç—å
2. –ò–ª–∏ —É–ø—Ä–æ—Å—Ç–∏—Ç—å –Ω–∞ `/platform` –±–µ–∑ tenant-id

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `ROUTING_GUIDE.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
- `docs/NAVIGATION_FLOW.md` - –ø–æ–¥—Ä–æ–±–Ω—ã–π flow –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- `PAGES_LIST.md` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü (—á–∞—Å—Ç–∏—á–Ω–æ —É—Å—Ç–∞—Ä–µ–ª)

