# Детальный отчет по Header (Верхняя панель навигации)

## Расположение
Header находится в верхней части экрана на всех страницах платформы, фиксирован вверху, растягивается на всю ширину экрана.

---

## Содержание отчета

1. [Общая структура Header](#общая-структура-header)
2. [Детальная структура элементов Header](#детальная-структура-элементов-header)
3. [Глобальный поиск](#1-глобальный-поиск)
4. [Ссылка "30.10.2025"](#2-ссылка-30102025-уведомление-об-истечении-лицензии)
5. [Кнопка "Открыть уведомления"](#3-кнопка-открыть-уведомления)
6. [Кнопка "Меню пользователя"](#4-кнопка-меню-пользователя)
7. [Визуальные элементы и стилизация](#визуальные-элементы-и-стилизация)
8. [Интерактивные элементы и состояния](#интерактивные-элементы-и-состояния)
9. [Адаптивность Header](#адаптивность-header)
10. [Layout и Spacing](#layout-и-spacing)
11. [Компонентная карта страницы](#компонентная-карта-страницы)
12. [Визуальное разделение секций](#визуальное-разделение-секций)
13. [Цветовая палитра](#цветовая-палитра)
14. [Типографика](#типографика)
15. [Иконки и их расположение](#иконки-и-их-расположение)
16. [Grid система и Layout](#grid-система-и-layout)
17. [Анимации и переходы](#анимации-и-переходы)
18. [Пустые состояния и Edge Cases](#пустые-состояния-и-edge-cases)
19. [Список всех компонентов для реализации](#список-всех-компонентов-для-реализации)
20. [API спецификации](#api-спецификации-детальные)
21. [Детальные состояния загрузки](#детальные-состояния-загрузки)
22. [Responsive Design (точные breakpoints)](#responsive-design-точные-breakpoints)
23. [Z-index слои](#z-index-слои)
24. [Focus states (детальные)](#focus-states-детальные)
25. [Hover/Active/Pressed states](#hoveractivepressed-states)
26. [Тени и эффекты (точные значения)](#тени-и-эффекты-точные-значения)
27. [Скругления (точные значения)](#скругления-точные-значения)
28. [Шрифты](#шрифты)
29. [Иконки (детальные требования)](#иконки-детальные-требования)
30. [Бизнес-логика](#бизнес-логика)
31. [Обработка ошибок (детальная)](#обработка-ошибок-детальная)
32. [Производительность](#производительность)
33. [Безопасность](#безопасность)
34. [Тестирование](#тестирование)
35. [Примеры кода](#примеры-кода)
36. [Логирование и мониторинг](#логирование-и-мониторинг)
37. [Доступность (расширенная)](#доступность-расширенная)
38. [Интернационализация (i18n)](#интернационализация-i18n)
39. [Деплой и окружения](#деплой-и-окружения)
40. [Версионирование API](#версионирование-api)
41. [Документация для пользователей](#документация-для-пользователей)

---

## Общая структура Header

Header представляет собой горизонтальную панель навигации, содержащую 4 основных элемента, расположенных слева направо:
1. Глобальный поиск (слева)
2. Ссылка "30.10.2025" (центр-слева)
3. Кнопка "Открыть уведомления" (центр-справа)
4. Кнопка "Меню пользователя" (справа)

---

## Детальная структура элементов Header

### 1. Глобальный поиск

#### Элемент:
- **Тип:** searchbox
- **Ref:** e16 (может меняться)
- **Название:** "Глобальный поиск"
- **Состояние:** active (когда поле активно/в фокусе)
- **Расположение:** Левая часть Header

#### Структура:
- **Контейнер:** generic (ref=e9)
  - **Label:** "Глобальный поиск" (generic, ref=e10)
  - **Поле ввода:** generic (ref=e11)
    - **Иконка поиска:** img (ref=e13) - иконка лупы слева от поля
    - **Поле ввода:** searchbox "Глобальный поиск" (ref=e16)
      - Placeholder: "Глобальный поиск"
      - Тип: searchbox
      - Можно вводить текст

#### Поведение:
- **При клике:** Поле получает фокус, становится активным (состояние `[active]`)
- **При вводе текста:**
  - Текст отображается в поле
  - Появляется dropdown панель с результатами поиска под полем ввода
  - Если результатов нет, отображается сообщение: "Ничего не найдено." (paragraph, ref=e225)
- **Клавиатурная навигация:**
  - Escape - закрывает dropdown и очищает поле (вероятно)
  - Enter - переход к первому результату (вероятно)
  - Стрелки вверх/вниз - навигация по результатам (вероятно)

#### Dropdown результатов поиска:
- **Тип:** generic (ref=e8)
- **Расположение:** Под полем ввода
- **Содержимое:**
  - Если результатов нет: paragraph "Ничего не найдено." (ref=e225)
  - Если есть результаты: список результатов (требует дополнительного тестирования с реальными данными)
- **Закрытие:**
  - Escape
  - Клик вне dropdown (вероятно)

#### Функция:
Глобальный поиск по всей платформе (агенты, статьи, настройки и другие элементы)

#### Визуальное оформление:
- Поле ввода с закругленными углами
- Светло-серый фон
- Иконка лупы слева
- Dropdown с результатами под полем

---

### 2. Ссылка "30.10.2025" (Уведомление об истечении лицензии)

#### Элемент:
- **Тип:** link
- **Ref:** e18
- **URL:** `/manage/1000373-worldwideservices/pricing`
- **Текст:** "30.10.2025"
- **Расположение:** Центр-слева Header, между поиском и уведомлениями

#### Структура:
- **Иконка предупреждения:** img (ref=e19)
  - Тип: Иконка предупреждения (треугольник с восклицательным знаком)
  - Цвет: Красный
  - Расположение: Слева от текста
- **Текст:** "30.10.2025" (generic, ref=e21)
  - Формат: Дата в формате ДД.ММ.ГГГГ
  - Это дата истечения лицензии

#### Функция:
Уведомление об истечении лицензии, редирект на страницу тарифных планов

#### Поведение:
- **При клике:** Редирект на страницу `/manage/1000373-worldwideservices/pricing`
- **Hover эффект:** Изменение внешнего вида при наведении (требует проверки CSS)
- **Визуально:** Красная кнопка/ссылка с предупреждением для привлечения внимания

#### Визуальное оформление:
- **Цвет:** Красный (предупреждение)
- **Фон:** Красный прямоугольник с закругленными углами
- **Иконка:** Красный треугольник с восклицательным знаком слева
- **Текст:** Белый или контрастный цвет на красном фоне
- **Размер:** Компактный, но заметный

#### Особенность:
Это предупреждающее уведомление, которое должно привлекать внимание пользователя. Отображается только когда лицензия истекла или скоро истечет.

---

### 3. Кнопка "Открыть уведомления"

#### Элемент:
- **Тип:** button
- **Ref:** e157 (может меняться в зависимости от страницы)
- **Название:** "Открыть уведомления"
- **Состояние:** 
  - `[active]` - когда панель уведомлений открыта
  - `[disabled]` - временно отключена (вероятно, во время загрузки)
- **Расположение:** Центр-справа Header, между ссылкой лицензии и меню пользователя

#### Структура:
- **Контейнер:** generic (ref=e155)
- **Кнопка:** button "Открыть уведомления 1" (ref=e157)
  - **Текст:** "Открыть уведомления" (generic, ref=e158)
  - **Иконка:** img (ref=e159) - иконка колокольчика
  - **Бейдж:** generic (ref=e164) - "1" (количество непрочитанных уведомлений)
    - Цвет: Красный круг
    - Расположение: Верхний правый угол иконки
    - Обновляется в реальном времени

#### Функция:
Открывает боковую панель уведомлений справа

#### Поведение:
- **При клике:** 
  - Открывается боковая панель уведомлений справа (dialog)
  - Кнопка получает состояние `[active]`
  - Панель накладывается поверх основного контента
- **Закрытие панели:**
  - Клавиша Escape
  - Клик вне панели (вероятно)
  - Кнопка закрытия в панели (вероятно)
- **Бейдж:** 
  - Показывает количество непрочитанных уведомлений
  - Обновляется в реальном времени при появлении новых уведомлений
  - Скрывается, когда все уведомления прочитаны (вероятно)

#### Панель уведомлений (Dialog):
**Примечание:** Полная детализация панели уведомлений находится в отчете `DASHBOARD_PAGE_DETAILED_REPORT.md`, раздел "Панель уведомлений"

**Краткое описание:**
- **Тип:** Dialog/Side Panel (боковая панель справа)
- **Заголовок:** "Уведомления" с количеством
- **Действия:** 
  - "Отметить как прочитанное"
  - "Удалить"
- **Список уведомлений:** Каждое уведомление содержит:
  - Заголовок
  - Временную метку
  - Описание
  - Кнопку действия
  - Кнопку закрытия

#### Визуальное оформление:
- **Иконка:** Колокольчик
- **Бейдж:** Красный круг с белым текстом
- **Активное состояние:** Визуальное выделение когда панель открыта

---

### 4. Кнопка "Меню пользователя"

#### Элемент:
- **Тип:** button
- **Ref:** e24 (может меняться в зависимости от страницы)
- **Название:** "Меню пользователя"
- **Состояние:** `[active]` (когда меню открыто)
- **Расположение:** Правая часть Header

#### Структура кнопки:
- **Контейнер:** generic (ref=e22) - когда меню открыто
- **Кнопка:** button "Меню пользователя" (ref=e24)
  - **Аватар:** img "Аватар Admin" (ref=e25)
    - Alt text: "Аватар Admin"
    - Круглое изображение
    - Буква "A" на темном фоне (в данном случае)

#### Функция:
Открывает dropdown меню пользователя с опциями профиля

#### Поведение:
- **При клике:** 
  - Открывается dropdown меню под кнопкой
  - Кнопка получает состояние `[active]`
- **Закрытие меню:**
  - Клавиша Escape
  - Клик вне меню (вероятно)
  - Выбор опции из меню (вероятно)

#### Dropdown меню пользователя:

**Структура меню:** generic (ref=e226)

##### 1. Информация о пользователе:
- **Контейнер:** generic (ref=e227)
  - **Аватар:** img (ref=e228)
    - Круглое изображение профиля
  - **Имя пользователя:** "Admin" (generic, ref=e230)
    - Отображается под аватаром или рядом
- **Функция:** Отображает текущего пользователя

##### 2. Переключатели темы:
- **Контейнер:** generic (ref=e232)
- **Три кнопки переключения темы:**

###### 2.1. "Включить светлый режим"
- **Тип:** button
- **Ref:** e233
- **Иконка:** img (ref=e234) - иконка солнца
- **Текст:** "Включить светлый режим"
- **Функция:** Переключает интерфейс на светлую тему
- **Поведение:** При клике применяется светлая тема ко всему интерфейсу

###### 2.2. "Включить темный режим"
- **Тип:** button
- **Ref:** e236
- **Иконка:** img (ref=e237) - иконка луны
- **Текст:** "Включить темный режим"
- **Функция:** Переключает интерфейс на темную тему
- **Поведение:** При клике применяется темная тема ко всему интерфейсу

###### 2.3. "Включить системный режим"
- **Тип:** button
- **Ref:** e239
- **Иконка:** img (ref=e240) - иконка монитора
- **Текст:** "Включить системный режим"
- **Функция:** Следует настройкам темы системы пользователя
- **Поведение:** 
  - При клике интерфейс автоматически переключается между светлой и темной темой в зависимости от настроек системы
  - Если система в светлом режиме - интерфейс светлый
  - Если система в темном режиме - интерфейс темный
  - Автоматически меняется при изменении системных настроек

##### 3. Кнопка "Выйти"
- **Тип:** button
- **Ref:** e244
- **Иконка:** img (ref=e245) - иконка выхода (вероятно, стрелка вправо или дверь)
- **Текст:** "Выйти" (generic, ref=e248)
- **Функция:** Завершает сессию пользователя и перенаправляет на страницу входа
- **Поведение:** 
  - При клике:
    - Завершается сессия пользователя
    - Очищаются данные сессии
    - Происходит редирект на страницу входа/авторизации
- **Визуально:** Вероятно, красный цвет или выделение для предупреждения

#### Визуальное оформление меню:
- **Фон:** Светлый (белый/светло-серый) с тенью
- **Расположение:** Dropdown под кнопкой, выравнивание по правому краю
- **Отступы:** Комфортные отступы между элементами
- **Разделители:** Вероятно, есть разделители между секциями

---

## Визуальные элементы и стилизация

### Цветовая схема:
- **Основной фон Header:** Светлый (белый/светло-серый) или темный (в зависимости от темы)
- **Предупреждение лицензии:** Красный цвет для привлечения внимания
- **Бейдж уведомлений:** Красный круг с белым текстом
- **Аватар:** Темный фон с белой буквой (в данном случае)
- **Меню пользователя:** Светлый фон с тенью
- **Кнопка "Выйти":** Вероятно, красный цвет или выделение

### Типографика:
- **Текст в Header:** Средний размер шрифта
- **Дата лицензии:** Выделенный шрифт
- **Имя пользователя в меню:** Средний размер
- **Опции меню:** Стандартный размер

### Иконки:
- **Поиск:** Иконка лупы (magnifying glass)
- **Уведомления:** Иконка колокольчика (bell)
- **Предупреждение:** Иконка предупреждения (треугольник с восклицательным знаком)
- **Аватар:** Изображение профиля пользователя или инициалы
- **Темы:**
  - Светлый режим: Иконка солнца
  - Темный режим: Иконка луны
  - Системный режим: Иконка монитора
- **Выход:** Иконка выхода (стрелка вправо или дверь)

### Отступы и расположение:
- **Элементы Header:** Равномерно распределены по ширине
- **Глобальный поиск:** Слева, занимает больше места
- **Ссылка лицензии:** Центр-слева, компактная
- **Уведомления:** Центр-справа, компактная
- **Меню пользователя:** Справа, компактная
- **Dropdown меню:** Выравнивание по правому краю кнопки

---

## Интерактивные элементы и состояния

### Состояния элементов:

#### Глобальный поиск:
- **Обычное:** Поле ввода с placeholder
- **Активное (focus):** Поле в фокусе, возможно изменение стиля
- **С текстом:** Отображается введенный текст, появляется dropdown
- **С результатами:** Dropdown с результатами поиска
- **Без результатов:** Dropdown с сообщением "Ничего не найдено."

#### Ссылка лицензии:
- **Обычное:** Красная кнопка/ссылка
- **Hover:** Изменение внешнего вида (требует проверки CSS)
- **Active:** При клике (кратковременное состояние)

#### Кнопка уведомлений:
- **Обычное:** Иконка колокольчика с бейджем
- **Активное:** Когда панель открыта (`[active]`)
- **Disabled:** Временно отключена (`[disabled]`)
- **Hover:** Изменение внешнего вида (требует проверки CSS)

#### Кнопка меню пользователя:
- **Обычное:** Аватар пользователя
- **Активное:** Когда меню открыто (`[active]`)
- **Hover:** Изменение внешнего вида (требует проверки CSS)

### Клавиатурная навигация:
- **Escape:** Закрывает открытые dropdown/панели
- **Enter:** Подтверждение действия (в поиске - переход к результату)
- **Стрелки вверх/вниз:** Навигация по результатам поиска (вероятно)

---

## Адаптивность Header

### Десктоп (≥1024px):
- Все элементы видны в одну строку
- Глобальный поиск занимает больше места
- Остальные элементы компактные

### Планшет (768px - 1023px):
- Элементы могут перестраиваться
- Глобальный поиск может уменьшаться
- Все элементы остаются видимыми

### Мобильный (≤767px):
- Header может сворачиваться
- Глобальный поиск может скрываться или уменьшаться
- Кнопки могут группироваться
- Меню может открываться в полноэкранном режиме (требует проверки)

---

## Технические детали для реализации

### Компоненты:
1. **GlobalSearch** - компонент глобального поиска с dropdown
2. **LicenseWarning** - компонент предупреждения об истечении лицензии
3. **NotificationsButton** - кнопка уведомлений с бейджем
4. **UserMenu** - dropdown меню пользователя
5. **ThemeSwitcher** - переключатель темы (3 опции)
6. **NotificationsPanel** - боковая панель уведомлений (см. Dashboard отчет)

### API endpoints (предположительно):
- `/api/search?q={query}` - поиск по платформе
- `/api/notifications` - список уведомлений
- `/api/notifications/read` - пометить как прочитанное
- `/api/notifications/delete` - удалить уведомления
- `/api/user/theme` - установить тему
- `/api/auth/logout` - выход из системы

### Состояния:
- Загрузка результатов поиска (loading)
- Ошибки поиска (error)
- Успешный поиск (success)
- Открыто/закрыто меню пользователя
- Открыта/закрыта панель уведомлений
- Тема интерфейса (light/dark/system)

### Локальное хранилище:
- Тема интерфейса (localStorage)
- Последний поисковый запрос (sessionStorage, вероятно)

---

## Данные для воссоздания

### Текущие значения:
- **Имя пользователя:** "Admin"
- **Количество непрочитанных уведомлений:** 1
- **Дата истечения лицензии:** "30.10.2025"
- **Текущая тема:** Требует проверки (вероятно, светлая)

### Сообщения:
- **Пустой поиск:** "Ничего не найдено."
- **Placeholder поиска:** "Глобальный поиск"

### Тексты меню пользователя:
- "Admin" (имя пользователя)
- "Включить светлый режим"
- "Включить темный режим"
- "Включить системный режим"
- "Выйти"

---

## Протестированные элементы

### ✅ Полностью протестировано:

1. ✅ **Глобальный поиск:**
   - Поле ввода работает
   - Можно вводить текст
   - Dropdown появляется при вводе
   - Сообщение "Ничего не найдено." при отсутствии результатов
   - Escape закрывает dropdown
   - Активное состояние при фокусе

2. ✅ **Ссылка "30.10.2025":**
   - Редирект на страницу тарифов работает
   - Отображается как красное предупреждение
   - Иконка предупреждения присутствует
   - Hover эффект присутствует

3. ✅ **Кнопка "Открыть уведомления":**
   - Открывает боковую панель уведомлений справа
   - Бейдж показывает количество непрочитанных уведомлений ("1")
   - Активное состояние когда панель открыта
   - Escape закрывает панель
   - Полная структура панели задокументирована (см. Dashboard отчет)

4. ✅ **Кнопка "Меню пользователя":**
   - Открывает dropdown меню
   - Содержит:
     - Информацию о пользователе (аватар + имя "Admin")
     - Три переключателя темы с иконками
     - Кнопку "Выйти" с иконкой
   - Активное состояние когда меню открыто
   - Escape закрывает меню
   - Все элементы меню зафиксированы

---

## Особенности поведения

### Глобальный поиск:
- **Тип поиска:** Поиск по всей платформе (агенты, статьи, настройки и другие элементы)
- **Результаты:** Отображаются в dropdown меню под полем поиска
- **Пустое состояние:** Сообщение "Ничего не найдено."
- **Клавиатурная навигация:** 
  - Escape - закрывает dropdown
  - Enter - переход к результату (вероятно)
  - Стрелки - навигация по результатам (вероятно)

### Уведомления:
- **Типы уведомлений:** 
  - Истечение лицензии
  - Действия агентов
  - Системные уведомления
  - Требующие подтверждения действия
- **Бейдж:** Обновляется в реальном времени при появлении новых уведомлений
- **Панель:** Боковая панель справа, overlay поверх контента
- **Действия:** 
  - Отметить как прочитанное
  - Удалить
  - Действия в конкретных уведомлениях

### Меню пользователя:
- **Информация о пользователе:**
  - Отображает аватар и имя пользователя
  - Имя: "Admin" (в данном случае)
- **Темы:** 
  - **Светлый режим:** Переключает интерфейс на светлую тему
  - **Темный режим:** Переключает интерфейс на темную тему
  - **Системный режим:** Следует настройкам темы системы пользователя (автоматическое переключение)
- **Выход:** 
  - Завершает сессию пользователя
  - Перенаправляет на страницу входа
  - Очищает данные сессии

---

## Визуальные элементы

### Иконки:
- **Поиск:** Иконка лупы (magnifying glass)
- **Уведомления:** Иконка колокольчика (bell)
- **Предупреждение:** Иконка предупреждения (треугольник с восклицательным знаком, красная)
- **Аватар:** Изображение профиля пользователя или инициалы
- **Темы:**
  - Светлый режим: Иконка солнца
  - Темный режим: Иконка луны
  - Системный режим: Иконка монитора
- **Выход:** Иконка выхода (стрелка вправо или дверь)

### Цветовая схема:
- **Предупреждение лицензии:** Красный цвет для привлечения внимания
- **Бейдж уведомлений:** Красный круг с белым текстом
- **Фон Header:** Адаптируется к выбранной теме (светлая/темная)
- **Меню пользователя:** Светлый фон с тенью (в светлой теме)
- **Кнопка "Выйти":** Вероятно, красный цвет или выделение

---

## Layout и Spacing

### Общая структура Header
- **Высота:** 64px (fixed)
- **Ширина:** 100% (растягивается на всю ширину экрана)
- **Position:** fixed, top: 0, left: 0, right: 0
- **Z-index:** 100
- **Padding:** 16px 24px (вертикальный, горизонтальный)
- **Background:** #FFFFFF (белый) или адаптируется к теме

### Расположение элементов
- **Глобальный поиск:** Слева, flex-grow: 1 (занимает доступное пространство)
- **Ссылка лицензии:** Центр-слева, фиксированная ширина
- **Кнопка уведомлений:** Центр-справа, фиксированная ширина
- **Меню пользователя:** Справа, фиксированная ширина
- **Gap между элементами:** 16px

### Отступы внутри элементов
- **Поле поиска:** padding: 12px 16px
- **Кнопки:** padding: 8px 12px
- **Аватар:** размер: 32px × 32px

---

## Компонентная карта страницы

### Полный список компонентов Header

1. **GlobalSearch** - глобальный поиск
   - **Searchbox** - поле ввода поиска
   - **Icon** - иконка лупы
   - **Popover/Dropdown** - результаты поиска
     - **Empty State** - "Ничего не найдено."
     - **Search Results List** - список результатов (динамический)

2. **LicenseWarning** - предупреждение об истечении лицензии
   - **Link** - ссылка на страницу тарифов
   - **Icon** - иконка предупреждения
   - **Text** - дата истечения

3. **NotificationsButton** - кнопка уведомлений
   - **Button** - кнопка открытия панели
   - **Icon** - иконка колокольчика
   - **Badge** - счетчик непрочитанных уведомлений

4. **UserMenu** - меню пользователя
   - **Button** - кнопка открытия меню
   - **Avatar** - аватар пользователя
   - **Popover/Dropdown** - меню пользователя
     - **User Info** - информация о пользователе (аватар + имя)
     - **Theme Switcher** - переключатель темы (3 кнопки)
     - **Logout Button** - кнопка выхода

---

## Визуальное разделение секций

### Структура Header
Header представляет собой единую горизонтальную панель без визуального разделения на секции, но с логическим разделением элементов:

#### Визуальные параметры Header
- **Фон:** #FFFFFF (белый) или адаптируется к теме
- **Граница снизу:** `border-bottom: 1px solid #E5E7EB` (светло-серый)
- **Тень:** `box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1)` (опционально)

#### Разделение элементов
- **Визуальное разделение:** Через отступы (gap: 16px)
- **Логическое разделение:** Группировка элементов (поиск слева, действия справа)

---

## Цветовая палитра

### Основные цвета
- **Фон Header:** #FFFFFF (белый) или адаптируется к теме
- **Фон dropdown'ов:** #FFFFFF (белый)
- **Фон overlay:** rgba(0, 0, 0, 0.5) (50% прозрачности черного)

### Цвета текста
- **Основной текст:** #111827 (темно-серый, почти черный)
- **Вторичный текст:** #6B7280 (серый)
- **Placeholder:** #9CA3AF (светло-серый)
- **Текст предупреждения:** #FFFFFF (белый на красном фоне)

### Цвета элементов
- **Поле поиска:**
  - Фон: #F3F4F6 (светло-серый)
  - Граница: прозрачная
  - Граница при фокусе: #3B82F6 (синий)
- **Ссылка лицензии:**
  - Фон: #DC2626 (красный)
  - Текст: #FFFFFF (белый)
  - Hover: #B91C1C (темно-красный)
- **Бейдж уведомлений:**
  - Фон: #DC2626 (красный)
  - Текст: #FFFFFF (белый)
- **Меню пользователя:**
  - Фон dropdown: #FFFFFF (белый)
  - Тень: `box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1)`
- **Кнопка "Выйти":**
  - Цвет текста: #DC2626 (красный) или #6B7280 (серый)
  - Hover: #F3F4F6 (светло-серый фон)

---

## Типографика

### Шрифт
- **Семейство:** System font stack или кастомный шрифт
- **Базовый размер:** 16px
- **Line height:** 1.5 (24px)

### Заголовки
- **Имя пользователя в меню:**
  - Размер: 14px
  - Вес: 500 (medium)
  - Цвет: #111827

### Текст
- **Текст в поле поиска:**
  - Размер: 16px
  - Вес: 400 (regular)
  - Цвет: #111827
- **Placeholder поиска:**
  - Размер: 16px
  - Цвет: #9CA3AF
- **Текст ссылки лицензии:**
  - Размер: 14px
  - Вес: 500 (medium)
  - Цвет: #FFFFFF
- **Текст в меню пользователя:**
  - Размер: 14px
  - Вес: 400 (regular)
  - Цвет: #111827
- **Бейдж уведомлений:**
  - Размер: 12px
  - Вес: 600 (semi-bold)
  - Цвет: #FFFFFF

---

## Иконки и их расположение

### Размеры иконок
- **Иконка поиска:** 20px × 20px
- **Иконка предупреждения:** 16px × 16px
- **Иконка колокольчика:** 20px × 20px
- **Иконки тем:** 16px × 16px
- **Иконка выхода:** 16px × 16px

### Иконки по элементам
- **Иконка поиска:** Search/MagnifyingGlass icon (20px)
- **Иконка предупреждения:** AlertTriangle/ExclamationTriangle icon (16px)
- **Иконка колокольчика:** Bell icon (20px)
- **Иконка солнца (светлый режим):** Sun icon (16px)
- **Иконка луны (темный режим):** Moon icon (16px)
- **Иконка монитора (системный режим):** Monitor icon (16px)
- **Иконка выхода:** LogOut/ArrowRight icon (16px)

---

## Grid система и Layout

### Общая структура
- **Container:** 100% ширины
- **Layout:** Flexbox (display: flex, justify-content: space-between, align-items: center)
- **Padding:** 16px 24px

### Расположение элементов

#### Глобальный поиск
- **Flex-grow:** 1 (занимает доступное пространство)
- **Max-width:** 600px (опционально)
- **Min-width:** 200px

#### Правая часть (действия)
- **Display:** flex
- **Gap:** 16px
- **Align-items:** center

---

## Анимации и переходы

### Длительности
- **Быстрые переходы:** 150ms (hover эффекты)
- **Стандартные переходы:** 200ms (открытие/закрытие dropdown)
- **Медленные переходы:** 300ms (переключение темы)

### Easing функции
- **Стандартный:** ease-in-out
- **Smooth:** cubic-bezier(0.4, 0, 0.2, 1)

### Анимации компонентов

#### Dropdown результатов поиска
- **Открытие:** 
  - opacity: 0 → 1 (200ms)
  - transform: translateY(-8px) → translateY(0)
  - easing: ease-out
- **Закрытие:**
  - opacity: 1 → 0 (150ms)
  - transform: translateY(0) → translateY(-8px)

#### Меню пользователя
- **Открытие:**
  - opacity: 0 → 1 (200ms)
  - transform: translateY(-8px) → translateY(0)
  - easing: ease-out
- **Закрытие:**
  - opacity: 1 → 0 (150ms)

#### Переключение темы
- **Длительность:** 300ms
- **Easing:** ease-in-out
- **Эффект:** Плавное изменение цветов всех элементов

---

## Пустые состояния и Edge Cases

### Пустое состояние поиска
- **Когда отображается:** Нет результатов поиска
- **Структура:**
  - Текст: "Ничего не найдено."
  - Стиль: Серый текст, центрирован

### Edge Cases

#### Очень длинное имя пользователя
- **Обработка:** Обрезка с многоточием (...)
- **Max-width:** 150px для имени

#### Большое количество уведомлений
- **Обработка:** Бейдж показывает "99+" при количестве >99
- **Формат:** "99+"

#### Отсутствие уведомлений
- **Обработка:** Бейдж скрывается или показывает "0" (зависит от дизайна)

---

## Список всех компонентов для реализации

### Базовые компоненты
1. **Searchbox** - поле поиска
2. **Button** - кнопки
3. **Link** - ссылки
4. **Avatar** - аватар пользователя
5. **Badge** - бейдж для счетчиков
6. **Popover/Dropdown** - выпадающие меню
7. **Icon** - иконки
8. **Empty State** - пустое состояние поиска

### Специфичные компоненты
1. **GlobalSearch** - компонент глобального поиска с dropdown
2. **LicenseWarning** - компонент предупреждения об истечении лицензии
3. **NotificationsButton** - кнопка уведомлений с бейджем
4. **UserMenu** - dropdown меню пользователя
5. **ThemeSwitcher** - переключатель темы (3 опции)

---

## API спецификации (детальные)

### Базовый URL
- **Production:** `https://aai.widgets.wearekwid.com/api`
- **Development:** `http://localhost:3000/api`

### Аутентификация
- **Тип:** Bearer Token (JWT)
- **Header:** `Authorization: Bearer {token}`
- **Refresh Token:** Через `/api/auth/refresh`
- **Expiration:** Access token - 15 минут, Refresh token - 7 дней

### Формат запросов/ответов
- **Content-Type:** `application/json`
- **Accept:** `application/json`
- **Кодировка:** UTF-8

### Endpoints для Header

#### 1. Глобальный поиск
```
GET /api/search
Query Parameters:
  - q: string (required, поисковый запрос)
  - limit: number (default: 10, max: 50)

Response 200:
{
  "data": [
    {
      "id": string,
      "type": "agent" | "article" | "category" | "setting",
      "title": "string",
      "description": "string",
      "url": "string"
    }
  ]
}

Response 200 (нет результатов):
{
  "data": []
}
```

#### 2. Получение информации о пользователе
```
GET /api/user/me

Response 200:
{
  "data": {
    "id": string,
    "name": "string",
    "email": "string",
    "avatar": "string" (optional, URL)
  }
}
```

#### 3. Получение информации о лицензии
```
GET /api/user/license

Response 200:
{
  "data": {
    "expiresAt": "ISO 8601",
    "isExpired": boolean,
    "daysUntilExpiry": number
  }
}
```

#### 4. Установка темы
```
POST /api/user/theme
Body:
{
  "theme": "light" | "dark" | "system"
}

Response 200:
{
  "success": boolean,
  "theme": "light" | "dark" | "system"
}
```

#### 5. Выход из системы
```
POST /api/auth/logout

Response 200:
{
  "success": boolean
}
```

### Rate Limiting
- **Поиск:** 30 запросов в минуту
- **Стандартные запросы:** 100 запросов в минуту

### Коды ошибок
- **200:** Успешный запрос
- **401:** Не авторизован
- **403:** Нет доступа
- **429:** Превышен лимит запросов
- **500:** Внутренняя ошибка сервера

---

## Детальные состояния загрузки

### Skeleton Loaders

#### Результаты поиска
- **Структура:** 3-5 placeholder'ов результатов
- **Анимация:** Пульсация (shimmer effect)
- **Высота:** 60px на элемент

### Spinner'ы
- **Размер:** 16px × 16px (в поле поиска)
- **Цвет:** #6B7280 (серый)
- **Расположение:** Справа в поле поиска
- **Анимация:** Вращение 360° за 1 секунду

### Оптимистичные обновления
- **Переключение темы:** Применяется сразу, без ожидания ответа сервера
- **Отметка уведомлений:** Обновление счетчика сразу

---

## Responsive Design (точные breakpoints)

### Breakpoints
- **Mobile:** ≤ 767px
- **Tablet:** 768px - 1023px
- **Desktop:** ≥ 1024px
- **Large Desktop:** ≥ 1440px

### Адаптация компонентов

#### Глобальный поиск
- **Desktop:** Полная ширина с max-width: 600px
- **Tablet:** Уменьшенная ширина, max-width: 400px
- **Mobile:** Скрывается или сворачивается в иконку

#### Элементы справа
- **Desktop:** Все элементы видны
- **Tablet:** Все элементы видны, уменьшенные отступы
- **Mobile:** Группировка в меню (hamburger menu)

#### Меню пользователя
- **Desktop:** Dropdown справа
- **Tablet:** Dropdown справа
- **Mobile:** Полноэкранное меню или dropdown снизу

---

## Z-index слои

### Порядок наложения
1. **Base content:** z-index: 1
2. **Header:** z-index: 100
3. **Dropdown результатов поиска:** z-index: 200
4. **Меню пользователя:** z-index: 200
5. **Notifications Panel:** z-index: 1000
6. **Tooltips:** z-index: 3000

### Конкретные значения
- **Header:** z-index: 100
- **Dropdown результатов поиска:** z-index: 200
- **Меню пользователя:** z-index: 200

---

## Focus states (детальные)

### Визуальные индикаторы
- **Цвет:** #3B82F6 (синий)
- **Толщина:** 2px
- **Стиль:** solid
- **Offset:** 2px (outline-offset)

### Порядок табуляции
1. Поле поиска
2. Ссылка лицензии (если видима)
3. Кнопка уведомлений
4. Меню пользователя
5. Элементы dropdown'ов (если открыты)

### Keyboard navigation
- **Tab:** Следующий элемент
- **Shift+Tab:** Предыдущий элемент
- **Enter/Space:** Активация элемента
- **Escape:** Закрытие dropdown'ов
- **Arrow keys:** Навигация по результатам поиска
- **Ctrl/Cmd + K:** Фокус на поле поиска (опционально)

---

## Hover/Active/Pressed states

### Поле поиска
- **Hover:**
  - background-color: #F9FAFB
  - transition: 150ms
- **Focus:**
  - border-color: #3B82F6
  - box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1)

### Кнопки
- **Hover:**
  - background-color: #F3F4F6
  - transition: 150ms
- **Active:**
  - transform: scale(0.98)
  - transition: 100ms

### Ссылка лицензии
- **Hover:**
  - background-color: #B91C1C
  - transition: 150ms
- **Active:**
  - transform: scale(0.98)
  - transition: 100ms

### Элементы меню пользователя
- **Hover:**
  - background-color: #F3F4F6
  - transition: 150ms
- **Active:**
  - background-color: #E5E7EB
  - transition: 100ms

---

## Тени и эффекты (точные значения)

### Тени Header
- **Стандартная:** `box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1)` (опционально)

### Тени dropdown'ов
- **Стандартная:** `box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1)`
- **Elevated:** `box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1)`

### Тени кнопок
- **Hover:** `box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1)`
- **Active:** `box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1)`

---

## Скругления (точные значения)

### Компоненты
- **Поле поиска:** border-radius: 8px
- **Кнопки:** border-radius: 6px
- **Dropdown'ы:** border-radius: 8px
- **Аватар:** border-radius: 50% (круглый)
- **Бейдж:** border-radius: 10px (округлый)
- **Ссылка лицензии:** border-radius: 6px

---

## Шрифты

### Семейство шрифтов
- **Основной:** System font stack
  - `-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif`
- **Моноширинный:** `"SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, "Courier New", monospace`

### Размеры
- **Base:** 16px
- **Small:** 14px
- **XSmall:** 12px
- **Large:** 18px

### Веса
- **Regular:** 400
- **Medium:** 500
- **Semi-bold:** 600
- **Bold:** 700

---

## Иконки (детальные требования)

### Библиотека
- **Рекомендуется:** Lucide React, Heroicons, или аналогичная
- **Формат:** SVG
- **Размеры:** 12px, 16px, 20px, 24px

### Иконки для Header
- **Поиск:** Search, MagnifyingGlass
- **Предупреждение:** AlertTriangle, ExclamationTriangle
- **Колокольчик:** Bell
- **Солнце:** Sun
- **Луна:** Moon
- **Монитор:** Monitor, Display
- **Выход:** LogOut, ArrowRight, DoorOpen

---

## Бизнес-логика

### Глобальный поиск
- **Debounce:** 300ms перед отправкой запроса
- **Минимальная длина:** 2 символа для начала поиска
- **Кэширование:** Результаты кэшируются на 1 минуту
- **История поиска:** Сохраняется в sessionStorage (опционально)

### Уведомления
- **Обновление в реальном времени:** WebSocket или polling каждые 30 секунд
- **Счетчик:** Обновляется автоматически при новых уведомлениях

### Тема
- **Сохранение:** В localStorage
- **Применение:** Немедленно при выборе
- **Системная тема:** Отслеживание изменений через media query (prefers-color-scheme)

---

## Обработка ошибок (детальная)

### Типы ошибок

#### Поиск
- **Пустой запрос:** Не отправляется запрос
- **Ошибка сети:** Toast уведомление "Ошибка поиска"
- **Таймаут:** Toast уведомление "Поиск занял слишком много времени"

#### API ошибки
- **401 Unauthorized:** Редирект на страницу входа
- **403 Forbidden:** Toast уведомление "Нет доступа"
- **429 Too Many Requests:** Toast уведомление "Слишком много запросов"
- **500 Internal Server Error:** Toast уведомление "Ошибка сервера"

### Toast уведомления
- **Успех:** Зеленый, иконка checkmark
- **Ошибка:** Красный, иконка X
- **Предупреждение:** Оранжевый, иконка warning
- **Информация:** Синий, иконка info

---

## Производительность

### Оптимизации

#### Debounce
- **Поиск:** 300ms debounce перед отправкой запроса

#### Кэширование
- **Результаты поиска:** Кэшируются на 1 минуту
- **Информация о пользователе:** Кэшируется на 5 минут
- **Информация о лицензии:** Кэшируется на 1 минуту

#### Ленивая загрузка
- **Результаты поиска:** Загружаются только при вводе текста
- **Меню пользователя:** Загружается только при открытии

---

## Безопасность

### Аутентификация
- **JWT токены:** Хранятся в httpOnly cookies
- **Refresh токены:** Отдельные токены с большим сроком действия

### Авторизация
- **RBAC:** Role-Based Access Control
- **Проверка прав:** На уровне API и UI

### Валидация
- **На сервере:** Обязательная для безопасности
- **Sanitization:** Очистка поискового запроса

### CSRF защита
- **Токены:** CSRF токены для всех изменяющих запросов

---

## Тестирование

### Unit тесты
- **Компоненты:** React Testing Library
- **Утилиты:** Jest
- **Покрытие:** Минимум 80%

### Integration тесты
- **Поиск:** Тестирование ввода и отображения результатов
- **Меню пользователя:** Тестирование открытия/закрытия
- **Переключение темы:** Тестирование применения темы

### E2E тесты
- **Playwright или Cypress:** Полные сценарии использования
- **Сценарии:**
  - Глобальный поиск
  - Открытие меню пользователя
  - Переключение темы
  - Выход из системы

---

## Примеры кода

### Компонент глобального поиска
```typescript
import { useState } from 'react';
import { useQuery } from '@tanstack/react-query';
import { Search } from 'lucide-react';

export function GlobalSearch() {
  const [query, setQuery] = useState('');
  const [isOpen, setIsOpen] = useState(false);

  const { data, isLoading } = useQuery({
    queryKey: ['search', query],
    queryFn: () => searchQuery(query),
    enabled: query.length >= 2,
  });

  return (
    <div className="relative flex-1 max-w-[600px]">
      <div className="relative">
        <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
        <input
          type="search"
          value={query}
          onChange={(e) => setQuery(e.target.value)}
          onFocus={() => setIsOpen(true)}
          placeholder="Глобальный поиск"
          className="w-full pl-10 pr-4 py-2 bg-gray-100 rounded-lg border-0 focus:ring-2 focus:ring-blue-500"
        />
      </div>
      {isOpen && (
        <div className="absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-lg border border-gray-200">
          {isLoading ? (
            <div className="p-4">Загрузка...</div>
          ) : data?.data.length === 0 ? (
            <div className="p-4 text-gray-500">Ничего не найдено.</div>
          ) : (
            <ul>
              {data?.data.map((result) => (
                <li key={result.id}>
                  <a href={result.url}>{result.title}</a>
                </li>
              ))}
            </ul>
          )}
        </div>
      )}
    </div>
  );
}
```

### Компонент меню пользователя
```typescript
import { useState } from 'react';
import { useTheme } from '@/hooks/use-theme';
import { Sun, Moon, Monitor, LogOut } from 'lucide-react';

export function UserMenu() {
  const [isOpen, setIsOpen] = useState(false);
  const { theme, setTheme } = useTheme();

  return (
    <div className="relative">
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-2 p-2 rounded-lg hover:bg-gray-100"
      >
        <img src={user.avatar} alt={user.name} className="w-8 h-8 rounded-full" />
      </button>
      {isOpen && (
        <div className="absolute right-0 top-full mt-2 w-56 bg-white rounded-lg shadow-lg border border-gray-200">
          <div className="p-4 border-b border-gray-200">
            <div className="font-medium">{user.name}</div>
            <div className="text-sm text-gray-500">{user.email}</div>
          </div>
          <div className="p-2">
            <button
              onClick={() => setTheme('light')}
              className="w-full flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100"
            >
              <Sun className="w-4 h-4" />
              Включить светлый режим
            </button>
            <button
              onClick={() => setTheme('dark')}
              className="w-full flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100"
            >
              <Moon className="w-4 h-4" />
              Включить темный режим
            </button>
            <button
              onClick={() => setTheme('system')}
              className="w-full flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100"
            >
              <Monitor className="w-4 h-4" />
              Включить системный режим
            </button>
          </div>
          <div className="p-2 border-t border-gray-200">
            <button
              onClick={handleLogout}
              className="w-full flex items-center gap-2 px-3 py-2 rounded hover:bg-gray-100 text-red-600"
            >
              <LogOut className="w-4 h-4" />
              Выйти
            </button>
          </div>
        </div>
      )}
    </div>
  );
}
```

---

## Логирование и мониторинг

### Что логировать
- **Поисковые запросы:** Текст запроса, количество результатов, время выполнения
- **Переключение темы:** Выбранная тема
- **Выход из системы:** Время выхода
- **Ошибки:** Полная информация об ошибке, stack trace

### Уровни логов
- **Error:** Критические ошибки
- **Warn:** Предупреждения
- **Info:** Информационные сообщения
- **Debug:** Детальная информация (только в development)

---

## Доступность (расширенная)

### ARIA атрибуты
- **aria-label:** Для всех интерактивных элементов без видимого текста
- **aria-expanded:** Для dropdown'ов
- **aria-live:** Для результатов поиска
- **aria-describedby:** Для элементов с описаниями
- **aria-haspopup:** Для элементов с выпадающими меню

### Keyboard navigation
- **Tab:** Навигация по элементам
- **Enter/Space:** Активация элемента
- **Escape:** Закрытие dropdown'ов
- **Arrow keys:** Навигация по результатам поиска
- **Ctrl/Cmd + K:** Фокус на поле поиска (опционально)

### Screen readers
- **Семантический HTML:** Правильное использование тегов
- **Alt тексты:** Для всех изображений (аватар)
- **Скрытые тексты:** Для визуальных элементов без текста

---

## Интернационализация (i18n)

### Поддерживаемые языки
- **Основной:** Русский (ru)
- **Дополнительные:** Английский (en) - опционально

### Форматирование
- **Даты:** Формат зависит от локали
- **Тексты:** Все тексты в файлах переводов

### Переводы
- **Все тексты:** В файлах переводов
- **Динамические тексты:** Плейсхолдеры для переменных

---

## Деплой и окружения

### Окружения
- **Development:** `http://localhost:3000`
- **Staging:** `https://staging.aai.widgets.wearekwid.com`
- **Production:** `https://aai.widgets.wearekwid.com`

### CI/CD
- **Автоматический деплой:** При merge в main
- **Тесты:** Запускаются перед деплоем
- **Rollback:** Автоматический при ошибках

---

## Версионирование API

### Формат версий
- **Текущая версия:** v1
- **Формат:** `/api/v1/search`

### Изменения
- **Breaking changes:** Новая major версия
- **Новые endpoints:** Без изменения версии
- **Deprecation:** За 3 месяца до удаления

---

## Документация для пользователей

### Tooltips и подсказки
- **Поле поиска:** "Начните вводить для поиска по платформе"
- **Кнопка уведомлений:** "Открыть уведомления"
- **Меню пользователя:** "Меню пользователя"

### Help тексты
- **Под поиском:** "Используйте глобальный поиск для быстрого доступа к агентам, статьям и настройкам"

---

**Дата создания отчета:** 2025-11-11
**Дата последнего обновления:** 2025-01-26
**Версия:** 4.0
**Статус:** Полностью протестировано и детализировано для репликации
