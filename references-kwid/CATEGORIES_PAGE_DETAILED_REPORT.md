# Детальный отчет по странице "Категории"

## URL
`https://aai.widgets.wearekwid.com/manage/1000373-worldwideservices/knowledge-categories`

## Title (Заголовок страницы)
"Категории - GPT Агент"

---

## Содержание отчета

1. [Общая структура страницы](#общая-структура-страницы)
2. [Основной контент](#основной-контент)
3. [Таблица категорий](#таблица-категорий)
4. [Модальное окно удаления](#модальное-окно-удалить-категорию)
5. [Пагинация](#пагинация)
6. [Страница создания/редактирования категории](#страница-созданияредактирования-категории)
7. [Технические детали для разработчиков](#технические-детали-для-разработчиков)
8. [Layout и Spacing](#layout-и-spacing)
9. [Компонентная карта страницы](#компонентная-карта-страницы)
10. [Визуальное разделение секций](#визуальное-разделение-секций)
11. [Цветовая палитра](#цветовая-палитра)
12. [Типографика](#типографика)
13. [Иконки и их расположение](#иконки-и-их-расположение)
14. [Grid система и Layout](#grid-система-и-layout)
15. [Анимации и переходы](#анимации-и-переходы)
16. [Пустые состояния и Edge Cases](#пустые-состояния-и-edge-cases)
17. [Список всех компонентов для реализации](#список-всех-компонентов-для-реализации)
18. [API спецификации](#api-спецификации-детальные)
19. [Детальные состояния загрузки](#детальные-состояния-загрузки)
20. [Валидация форм (детальная)](#валидация-форм-детальная)
21. [Responsive Design (точные breakpoints)](#responsive-design-точные-breakpoints)
22. [Z-index слои](#z-index-слои)
23. [Focus states (детальные)](#focus-states-детальные)
24. [Hover/Active/Pressed states](#hoveractivepressed-states)
25. [Тени и эффекты (точные значения)](#тени-и-эффекты-точные-значения)
26. [Скругления (точные значения)](#скругления-точные-значения)
27. [Шрифты](#шрифты)
28. [Иконки (детальные требования)](#иконки-детальные-требования)
29. [Бизнес-логика](#бизнес-логика)
30. [Обработка ошибок (детальная)](#обработка-ошибок-детальная)
31. [Производительность](#производительность)
32. [Безопасность](#безопасность)
33. [Тестирование](#тестирование)
34. [Примеры кода](#примеры-кода)
35. [Логирование и мониторинг](#логирование-и-мониторинг)
36. [Доступность (расширенная)](#доступность-расширенная)
37. [Интернационализация (i18n)](#интернационализация-i18n)
38. [Деплой и окружения](#деплой-и-окружения)
39. [Версионирование API](#версионирование-api)
40. [Документация для пользователей](#документация-для-пользователей)

---

## Общая структура страницы

### Header (Верхняя панель)
- **Глобальный поиск** (ref=e16)
- **Ссылка на тарифы** "30.10.2025" (ref=e18) → `/pricing`
- **Кнопка уведомлений** "Открыть уведомления 2" (ref=e24) - показывает количество непрочитанных уведомлений
- **Меню пользователя** (ref=e34) - аватар пользователя

### Sidebar (Боковая панель)
- Полная структура описана в `SIDEBAR_DETAILED_REPORT.md`
- Активный раздел: "База знаний" > "Категории"

### Main Content (Основной контент)

#### 1. Навигация страницы (Breadcrumbs)
- **Структура:**
  - `navigation` (ref=e41)
    - `list` (ref=e42)
      - `listitem` (ref=e43)
        - `link` "Категории" (ref=e44) → `/knowledge-categories`
      - `listitem` (ref=e45)
        - `img` (ref=e46) - разделитель
        - `generic` "Список" (ref=e48)

#### 2. Заголовок страницы
- **Элемент:** `heading` (ref=e49)
- **Текст:** "Категории"
- **Уровень:** h1

#### 3. Кнопка "Создать"
- **Тип:** link (ссылка, не кнопка)
- **Ref:** e52
- **URL:** `/manage/1000373-worldwideservices/knowledge-categories/create`
- **Текст:** "Создать" (generic, ref=e53)
- **Расположение:** Справа от заголовка
- **Функция:** Переход на отдельную страницу создания новой категории
- **Поведение:**
  - При клике происходит **переход на отдельную страницу** (не открывается модальное окно)
  - URL меняется на `/knowledge-categories/create`
  - Заголовок страницы меняется на "Создать Категория - GPT Агент"
  - В навигации появляется хлебная крошка "Категории > Создать"
  - Header и Sidebar остаются видимыми

---

## Основной контент

### Панель инструментов

#### 1. Кнопка "Фильтр"
- **Тип:** button
- **Ref:** e64
- **Текст:** "Фильтр" (generic, ref=e65)
- **Иконка:** img (ref=e66)
- **Бейдж:** generic (ref=e71) - показывает количество активных фильтров ("0")
- **Расположение:** Слева от таблицы
- **Функция:** Открывает dropdown с фильтрами
- **Поведение:**
  - При клике открывается Popover/Dropdown
  - Кнопка получает состояние `[active]`
  - Dropdown позиционируется относительно кнопки

##### Dropdown "Фильтры"

**Структура:**
- **Тип:** Popover/Dropdown
- **Контейнер:** generic (ref=e269)
- **Позиционирование:** Относительно кнопки "Фильтр"
- **Визуальное оформление:**
  - Белый фон
  - Тень
  - Закругленные углы

**Заголовок dropdown:**
- **Контейнер:** generic (ref=e270)
- **Заголовок:** `heading` "Фильтры" (level=4, ref=e271)
- **Кнопка "Сбросить":**
  - Тип: button
  - Ref: e273
  - Текст: "Сбросить" (generic, ref=e274)
  - Функция: Сбрасывает все активные фильтры
  - Поведение:
    - Удаляет все выбранные фильтры
    - Обновляет URL (удаляет параметры фильтров)
    - Обновляет бейдж на кнопке "Фильтр" (показывает "0")
    - Обновляет отображаемые активные фильтры

**Фильтр "Родительская категория":**
- **Контейнер:** generic (ref=e281)
- **Label:** generic (ref=e284) - "Родительская категория"
- **Поле выбора:**
  - Контейнер: generic (ref=e290)
  - **Поле ввода:**
    - Тип: textbox
    - Ref: e292
    - Placeholder: "Выберите родительскую категорию"
    - Класс: "tree-parent_id-label"
  - **Иконка стрелки:** img (ref=e296)
- **Тип:** Tree selector (выбор категории из иерархического списка)
- **Функция:** Фильтрация категорий по родительской категории
- **Поведение:**
  - При клике на поле открывается dropdown с иерархическим списком категорий
  - При выборе категории применяется фильтр
  - Обновляется URL с параметром `tableFilters[category_filter][parent_id]=ID`
  - Обновляется бейдж на кнопке "Фильтр"
  - Dropdown закрывается

**Общее поведение dropdown:**
- Открывается при клике на кнопку "Фильтр"
- Закрывается при:
  - Клике вне dropdown
  - Нажатии Escape
  - Применении фильтра
  - Нажатии на кнопку "Сбросить"
- Изменения применяются автоматически при выборе фильтра

#### 2. Кнопка "Переключить столбцы"
- **Тип:** button
- **Ref:** e74
- **Текст:** "Переключить столбцы" (generic, ref=e75)
- **Иконка:** img (ref=e76)
- **Расположение:** Справа от кнопки "Фильтр"
- **Функция:** Открывает dropdown для управления видимостью столбцов таблицы
- **Поведение:**
  - При клике открывается Popover/Dropdown
  - Кнопка получает состояние `[active]`
  - Dropdown позиционируется относительно кнопки

##### Dropdown "Столбцы"

**Структура:**
- **Тип:** Popover/Dropdown
- **Контейнер:** generic (ref=e299)
- **Позиционирование:** Относительно кнопки "Переключить столбцы"
- **Визуальное оформление:**
  - Белый фон
  - Тень
  - Закругленные углы

**Заголовок dropdown:**
- **Элемент:** `heading` "Столбцы" (level=4, ref=e300)

**Список столбцов:**
- **Контейнер:** generic (ref=e301)

**Чекбокс "Created at":**
- **Контейнер:** generic (ref=e306)
- **Тип:** checkbox
- **Ref:** e307
- **Label:** generic (ref=e308) - "Created at"
- **Функция:** Показать/скрыть столбец "Created at" в таблице
- **Состояния:**
  - Checked: Столбец видим
  - Unchecked: Столбец скрыт
- **Поведение:**
  - При клике переключает состояние
  - Изменения применяются немедленно
  - Состояние сохраняется (persist)

**Чекбокс "Updated at":**
- **Контейнер:** generic (ref=e313)
- **Тип:** checkbox
- **Ref:** e314
- **Label:** generic (ref=e315) - "Updated at"
- **Функция:** Показать/скрыть столбец "Updated at" в таблице
- **Состояния:**
  - Checked: Столбец видим
  - Unchecked: Столбец скрыт
- **Поведение:**
  - При клике переключает состояние
  - Изменения применяются немедленно
  - Состояние сохраняется (persist)

**Общее поведение dropdown:**
- Открывается при клике на кнопку "Переключить столбцы"
- Закрывается при:
  - Клике вне dropdown
  - Нажатии Escape
- Изменения применяются немедленно при переключении чекбоксов
- Состояние чекбоксов сохраняется между сессиями

---

## Таблица категорий

### Структура таблицы
- **Тип:** table
- **Ref:** e79

### Заголовок таблицы (Header)
- **Контейнер:** rowgroup (ref=e80)
- **Строка:** row (ref=e81)

#### Столбцы заголовка:

1. **Checkbox "Выбрать все"**
   - **Ячейка:** cell (ref=e82)
   - **Контейнер:** generic (ref=e84)
   - **Элемент:** checkbox (ref=e85)
   - **Label:** generic (ref=e86) - "Выбрать/снять все элементы для массовых действий."
   - **Функция:** Выбрать/снять все категории для массовых действий
   - **Поведение:**
     - При клике выбирает/снимает все категории на странице
     - Обновляет состояние всех чекбоксов в строках

2. **Столбец "Заголовок"**
   - **Ячейка:** cell (ref=e87)
   - **Кнопка сортировки:**
     - Тип: button
     - Ref: e88
     - Текст: "Заголовок" (generic, ref=e89)
     - Иконка: img (ref=e90) - стрелка сортировки
   - **Функция:** Сортировка таблицы по заголовку
   - **Поведение:**
     - При клике переключает сортировку (ASC → DESC → без сортировки)
     - Обновляет иконку стрелки
     - Обновляет URL с параметром сортировки

3. **Столбец "Подкатегории"**
   - **Ячейка:** cell (ref=e92)
   - **Текст:** generic (ref=e94) - "Подкатегории"
   - **Функция:** Отображает количество подкатегорий

4. **Столбец "Статьи"**
   - **Ячейка:** cell (ref=e95)
   - **Текст:** generic (ref=e97) - "Статьи"
   - **Функция:** Отображает количество статей в категории

5. **Столбец "Actions"**
   - **Ячейка:** cell (ref=e98)
   - **Функция:** Отображает действия для категории

### Строки данных (Body)
- **Контейнер:** rowgroup (ref=e99)

#### Пример строки (ID: 582, "Общее"):

**Структура строки:**
- **Строка:** row (ref=e100)

1. **Checkbox выбора**
   - **Ячейка:** cell (ref=e101)
   - **Контейнер:** generic (ref=e103)
   - **Элемент:** checkbox (ref=e104)
   - **Label:** generic (ref=e105) - "Выбрать/отменить 582 для массовых действий."
   - **Функция:** Выбрать/снять категорию для массовых действий
   - **Поведение:**
     - При клике выбирает/снимает категорию
     - Обновляет состояние checkbox "Выбрать все"

2. **Заголовок категории**
   - **Ячейка:** cell (ref=e106)
   - **Ссылка:** link (ref=e108)
   - **URL:** `/knowledge-categories?tableFilters[category_filter][parent_id]=582`
   - **Контейнер:** generic (ref=e112)
   - **Иконка:** img (ref=e113) - иконка категории
   - **Текст:** generic (ref=e115) - "Общее"
   - **Функция:** Фильтрация по подкатегориям (показать подкатегории)
   - **Поведение:**
     - При клике применяет фильтр по родительской категории
     - Показывает только подкатегории выбранной категории
     - Обновляет URL с параметром фильтра

3. **Количество подкатегорий**
   - **Ячейка:** cell (ref=e116)
   - **Ссылка:** link (ref=e118)
   - **URL:** `/knowledge-categories?tableFilters[category_filter][parent_id]=582`
   - **Текст:** generic (ref=e123) - "0"
   - **Функция:** Фильтрация по подкатегориям (аналогично заголовку)
   - **Поведение:** При клике применяет фильтр по родительской категории

4. **Количество статей**
   - **Ячейка:** cell (ref=e124)
   - **Ссылка:** link (ref=e126)
   - **URL:** `/knowledge-categories?tableFilters[category_filter][parent_id]=582`
   - **Текст:** generic (ref=e131) - "0"
   - **Функция:** Фильтрация по подкатегориям (аналогично заголовку)
   - **Поведение:** При клике применяет фильтр по родительской категории

5. **Действия (Actions)**
   - **Ячейка:** cell (ref=e132)
   - **Контейнер:** generic (ref=e134)

   **a) Ссылка "Показать подкатегории"**
   - **Тип:** link
   - **Ref:** e135
   - **URL:** `/knowledge-categories?tableFilters[category_filter][parent_id]=582`
   - **Текст:** generic (ref=e136) - "Показать подкатегории"
   - **Иконка:** img (ref=e137)
   - **Функция:** Фильтрация по подкатегориям
   - **Поведение:**
     - При клике применяет фильтр по родительской категории
     - Показывает только подкатегории выбранной категории
     - Обновляет URL с параметром фильтра

   **b) Ссылка "Редактировать"**
   - **Тип:** link
   - **Ref:** e139
   - **URL:** `/knowledge-categories/582/edit`
   - **Текст:** generic (ref=e140) - "Редактировать"
   - **Иконка:** img (ref=e141)
   - **Функция:** Переход на страницу редактирования категории
   - **Поведение:**
     - При клике происходит переход на отдельную страницу редактирования
     - URL меняется на `/knowledge-categories/582/edit`
     - Заголовок страницы меняется на "Редактирование Общее - GPT Агент"

   **c) Кнопка "Удалить"**
   - **Тип:** button
   - **Ref:** e144
   - **Текст:** generic (ref=e145) - "Удалить"
   - **Иконка:** img (ref=e146)
   - **Функция:** Открывает модальное окно подтверждения удаления
   - **Поведение:**
     - При клике открывается модальное окно подтверждения
     - Модальное окно блокирует взаимодействие с остальной страницей

---

## Модальное окно "Удалить категорию"

### Структура модального окна
- **Тип:** dialog
- **Контейнер:** generic (ref=e272)

### Заголовок модального окна
- **Контейнер:** generic (ref=e273)
- **Кнопка "Закрыть":**
  - Тип: button
  - Ref: e275
  - Текст: "Закрыть" (generic, ref=e276)
  - Иконка: img (ref=e277) - иконка закрытия (X)
  - Функция: Закрывает модальное окно без удаления
  - Поведение:
    - При клике закрывает модальное окно
    - Возвращает фокус на страницу
- **Иконка:** img (ref=e281) - иконка предупреждения/удаления
- **Контент:**
  - **Заголовок:** `heading` "Удалить Общее" (level=2, ref=e284)
  - **Текст:** `paragraph` (ref=e285) - "Вы уверены, что хотите это сделать?"

### Кнопки действий
- **Контейнер:** generic (ref=e287)

**Кнопка "Отменить":**
- **Тип:** button
- **Ref:** e288
- **Текст:** generic (ref=e289) - "Отменить"
- **Состояние:** `[active]` - активная кнопка (по умолчанию)
- **Функция:** Закрывает модальное окно без удаления
- **Поведение:**
  - При клике закрывает модальное окно
  - Возвращает фокус на страницу
  - Категория не удаляется

**Кнопка "Удалить":**
- **Тип:** button
- **Ref:** e290
- **Текст:** generic (ref=e291) - "Удалить"
- **Функция:** Подтверждает удаление категории
- **Поведение:**
  - При клике удаляет категорию
  - Закрывает модальное окно
  - Обновляет таблицу (удаляет строку)
  - Показывает уведомление об успешном удалении

### Общее поведение модального окна
- Открывается при клике на кнопку "Удалить" в строке категории
- Закрывается при:
  - Клике на кнопку "Закрыть"
  - Клике на кнопку "Отменить"
  - Клике вне модального окна (на overlay)
  - Нажатии Escape
- Блокирует взаимодействие с остальной страницей (overlay)
- Фокус автоматически устанавливается на кнопку "Отменить"

---

## Пагинация

### Структура пагинации
- **Тип:** navigation
- **Ref:** e148
- **Атрибут:** "Пагинация"

### Информация о страницах
- **Контейнер:** generic (ref=e149)
- **Текст:** "Показано с 1 по 1 из 1"
- **Функция:** Отображает текущий диапазон записей и общее количество

### Выбор количества записей на странице
- **Контейнер:** generic (ref=e152)
- **Label:** generic (ref=e154) - "на страницу"
- **Combobox:**
  - Тип: combobox
  - Ref: e156
  - **Опции:**
    - option "10" [selected] - по умолчанию
    - option "25"
    - option "50"
    - option "100"
  - **Функция:** Изменение количества записей на странице
  - **Поведение:**
    - При выборе опции обновляется количество записей на странице
    - Обновляется URL с параметром пагинации
    - Таблица перезагружается с новым количеством записей

---

## Страница создания/редактирования категории

### ⚠️ ВАЖНО: Это отдельная страница, НЕ модальное окно!

При нажатии на кнопку "Создать" происходит:
- **Переход на отдельную страницу** (не открывается модальное окно)
- **Изменение URL:** с `/knowledge-categories` на `/knowledge-categories/create`
- **Изменение заголовка страницы:** с "Категории - GPT Агент" на "Создать Категория - GPT Агент"
- **Обновление навигации:** появляется хлебная крошка "Категории > Создать"
- **Сохранение Header и Sidebar:** они остаются видимыми на странице

### URL создания
`https://aai.widgets.wearekwid.com/manage/1000373-worldwideservices/knowledge-categories/create`

### URL редактирования
`https://aai.widgets.wearekwid.com/manage/1000373-worldwideservices/knowledge-categories/582/edit`

### Title (Заголовок страницы)
- **Создание:** "Создать Категория - GPT Агент"
- **Редактирование:** "Редактирование Общее - GPT Агент"

### Навигация страницы (Breadcrumbs)

**Создание:**
- Категории → Создать

**Редактирование:**
- Категории → Общее → Редактирование

### Заголовок страницы
- **Создание:** `heading` "Создать Категория" (level=1, ref=e49)
- **Редактирование:** `heading` "Редактирование Общее" (level=1, ref=e53)

### Кнопка "Удалить" (только на странице редактирования)
- **Тип:** button
- **Ref:** e56
- **Текст:** generic (ref=e57) - "Удалить"
- **Расположение:** Справа от заголовка
- **Функция:** Открывает модальное окно подтверждения удаления
- **Поведение:** Аналогично кнопке "Удалить" в таблице

### Форма создания/редактирования

#### 1. Поле "Родительская категория"
- **Контейнер:** generic (ref=e61 / e69)
- **Label:** generic (ref=e64 / e72) - "Родительская категория"
- **Поле выбора:**
  - Контейнер: generic (ref=e70 / e78)
  - **Поле ввода:**
    - Тип: textbox
    - Ref: e72 / e80
    - Placeholder: "Выберите родительскую категорию"
    - Класс: "tree-parent_id-label"
  - **Иконка стрелки:** img (ref=e76 / e84)
- **Тип:** Tree selector (выбор категории из иерархического списка)
- **Обязательное:** Нет
- **Функция:** Выбор родительской категории для создания иерархии
- **Поведение:**
  - При клике на поле открывается dropdown с иерархическим списком категорий
  - При выборе категории она отображается в поле
  - Можно оставить пустым (создать корневую категорию)

#### 2. Поле "Заголовок"
- **Контейнер:** generic (ref=e80 / e88)
- **Label:**
  - Текст: "Заголовок" (generic, ref=e83 / e91)
  - Обязательное поле: superscript "*" (ref=e84 / e92)
- **Поле ввода:**
  - Тип: textbox
  - Ref: e88 / e96
  - Placeholder: "Заголовок*"
  - Значение (при редактировании): "Общее"
- **Обязательное:** Да (обозначено звездочкой)
- **Функция:** Ввод названия категории
- **Поведение:**
  - Валидация: поле обязательно для заполнения
  - При редактировании предзаполнено текущим значением

#### 3. Поле "Описание"
- **Контейнер:** generic (ref=e91 / e99)
- **Label:** generic (ref=e94 / e102) - "Описание"
- **Поле ввода:**
  - Тип: textbox
  - Ref: e99 / e107
  - Placeholder: "Описание"
- **Обязательное:** Нет
- **Функция:** Ввод описания категории
- **Поведение:**
  - Многострочное поле (textarea)
  - Необязательное для заполнения

### Кнопки действий формы

#### Страница создания:

**Кнопка "Создать":**
- **Тип:** button
- **Ref:** e102
- **Текст:** generic (ref=e103) - "Создать"
- **Функция:** Создает категорию и возвращает на страницу списка
- **Поведение:**
  - Валидирует форму
  - Создает категорию
  - Перенаправляет на страницу списка категорий
  - Показывает уведомление об успешном создании

**Кнопка "Создать и Создать еще":**
- **Тип:** button
- **Ref:** e104
- **Текст:** generic (ref=e105) - "Создать и Создать еще"
- **Функция:** Создает категорию и остается на странице создания
- **Поведение:**
  - Валидирует форму
  - Создает категорию
  - Очищает форму
  - Остается на странице создания
  - Показывает уведомление об успешном создании

**Кнопка "Отмена":**
- **Тип:** button
- **Ref:** e106
- **Текст:** generic (ref=e107) - "Отмена"
- **Функция:** Отменяет создание и возвращает на страницу списка
- **Поведение:**
  - При клике возвращает на страницу списка категорий
  - Не сохраняет данные формы

#### Страница редактирования:

**Кнопка "Сохранить":**
- **Тип:** button
- **Ref:** e110
- **Текст:** generic (ref=e111) - "Сохранить"
- **Функция:** Сохраняет изменения и возвращает на страницу списка
- **Поведение:**
  - Валидирует форму
  - Сохраняет изменения
  - Перенаправляет на страницу списка категорий
  - Показывает уведомление об успешном сохранении

**Кнопка "Отмена":**
- **Тип:** button
- **Ref:** e112
- **Текст:** generic (ref=e113) - "Отмена"
- **Функция:** Отменяет редактирование и возвращает на страницу списка
- **Поведение:**
  - При клике возвращает на страницу списка категорий
  - Не сохраняет изменения

### Секция "Knowledge Items" (только на странице редактирования)

#### Заголовок секции
- **Элемент:** `heading` "Knowledge Items" (level=3, ref=e122)

#### Панель инструментов
- **Контейнер:** generic (ref=e124)

**Поиск:**
- **Контейнер:** generic (ref=e125)
- **Label:** generic (ref=e126) - "Поиск"
- **Поле поиска:**
  - Контейнер: generic (ref=e127)
  - Иконка: img (ref=e129)
  - Поле: searchbox "Поиск" (ref=e132)
- **Функция:** Поиск статей в категории
- **Поведение:** Фильтрует список статей по введенному тексту

**Кнопка "Фильтр":**
- **Тип:** button
- **Ref:** e135
- **Текст:** "Фильтр" (generic, ref=e136)
- **Иконка:** img (ref=e137)
- **Бейдж:** generic (ref=e142) - показывает количество активных фильтров ("0")
- **Функция:** Открывает dropdown с фильтрами для статей

**Кнопка "Переключить столбцы":**
- **Тип:** button
- **Ref:** e145
- **Текст:** "Переключить столбцы" (generic, ref=e146)
- **Иконка:** img (ref=e147)
- **Функция:** Управление видимостью столбцов таблицы статей

#### Сообщение "Не найдено"
- **Контейнер:** generic (ref=e151)
- **Иконка:** img (ref=e153)
- **Заголовок:** `heading` "Не найдено Статьиs" (level=4, ref=e155)
- **Функция:** Отображается, когда в категории нет статей

---

## Технические детали для разработчиков

### Компоненты и структура

1. **Таблица категорий:**
   - Использует компонент таблицы с поддержкой сортировки, фильтрации и пагинации
   - Поддерживает массовые действия через checkbox
   - Интегрирована с системой фильтров

2. **Dropdown фильтров:**
   - Popover/Dropdown компонент
   - Tree selector для выбора категорий
   - Автоматическое применение фильтров

3. **Dropdown "Переключить столбцы":**
   - Popover/Dropdown компонент
   - Чекбоксы для управления видимостью столбцов
   - Сохранение состояния в localStorage

4. **Модальное окно удаления:**
   - Dialog компонент с overlay
   - Подтверждение действия
   - Блокировка взаимодействия с остальной страницей

5. **Форма создания/редактирования:**
   - Отдельная страница (не модальное окно)
   - Валидация полей
   - Tree selector для выбора родительской категории
   - Множественные кнопки действий

### URL параметры

- **Фильтрация:** `?tableFilters[category_filter][parent_id]=ID`
- **Сортировка:** `?tableSortColumn=title&tableSortDirection=asc|desc`
- **Пагинация:** `?tableRecordsPerPage=10|25|50|100`

### Состояния и поведение

1. **Фильтры:**
   - Автоматическое применение при выборе
   - Отображение активных фильтров в бейдже
   - Сброс всех фильтров через кнопку "Сбросить"

2. **Сортировка:**
   - Переключение между ASC, DESC и без сортировки
   - Визуальная индикация направления сортировки

3. **Пагинация:**
   - Динамическое изменение количества записей
   - Сохранение выбранного значения

4. **Массовые действия:**
   - Выбор всех записей через checkbox в заголовке
   - Индивидуальный выбор через checkbox в строке

### Визуальные детали

1. **Цветовая схема:**
   - Основные кнопки: синий/primary цвет
   - Кнопка удаления: красный/danger цвет
   - Активные элементы: выделены цветом

2. **Иконки:**
   - Стрелки для сортировки
   - Иконки действий (редактировать, удалить)
   - Иконки категорий

3. **Анимации:**
   - Плавное открытие/закрытие dropdown
   - Плавное открытие/закрытие модального окна
   - Переходы между страницами

### Адаптивность

- Таблица адаптируется под размер экрана
- Dropdown позиционируются автоматически
- Модальное окно центрируется на экране
- Форма адаптируется под мобильные устройства

---

## Полная структура с refs

### Страница списка категорий

```
main (ref=e36)
  └─ generic (ref=e38)
      ├─ generic (ref=e39) - Заголовок и навигация
      │   ├─ generic (ref=e40)
      │   │   └─ navigation (ref=e41) - Breadcrumbs
      │   └─ heading (ref=e49) - "Категории"
      ├─ link (ref=e52) - "Создать"
      └─ generic (ref=e57) - Основной контент
          └─ generic (ref=e58)
              ├─ generic (ref=e61) - Панель инструментов
              │   ├─ button (ref=e64) - "Фильтр"
              │   └─ button (ref=e74) - "Переключить столбцы"
              ├─ table (ref=e79) - Таблица категорий
              └─ navigation (ref=e148) - Пагинация
```

### Модальное окно удаления

```
dialog
  └─ generic (ref=e272)
      ├─ generic (ref=e273) - Заголовок
      │   ├─ button (ref=e275) - "Закрыть"
      │   ├─ img (ref=e281) - Иконка
      │   └─ generic (ref=e283) - Контент
      │       ├─ heading (ref=e284) - "Удалить Общее"
      │       └─ paragraph (ref=e285) - "Вы уверены..."
      └─ generic (ref=e287) - Кнопки
          ├─ button (ref=e288) - "Отменить"
          └─ button (ref=e290) - "Удалить"
```

### Страница создания/редактирования

```
main (ref=e36 / e26)
  └─ generic (ref=e37 / e27)
      ├─ generic (ref=e38 / e28) - Заголовок
      └─ generic (ref=e52 / e42) - Форма
          └─ generic (ref=e58 / e48) - Поля формы
              ├─ generic (ref=e61 / e51) - Родительская категория
              ├─ generic (ref=e80 / e70) - Заголовок
              ├─ generic (ref=e91 / e81) - Описание
              └─ generic (ref=e101 / e91) - Кнопки действий
```

---

## Layout и Spacing

### Общая структура страницы
- **Максимальная ширина контента:** 1200px (центрирован)
- **Отступы от краев:** 24px (desktop), 16px (tablet), 12px (mobile)
- **Отступ между Header и Main Content:** 24px
- **Отступ между Sidebar и Main Content:** 24px

### Разделение секций
- **Отступ между секциями:** 32px (вертикальный)
- **Визуальное разделение секций:**
  - Каждая секция в отдельной карточке (card)
  - Фон карточки: белый (#FFFFFF)
  - Тень: `box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1)`
  - Скругление углов: `border-radius: 8px`
  - Внутренние отступы карточки: `padding: 24px`
  - Граница: `border: 1px solid #E5E7EB` (опционально)

### Отступы внутри секций
- **Отступ между заголовком секции и содержимым:** 16px
- **Отступ между полями формы:** 20px (вертикальный)
- **Отступ между label и input:** 8px
- **Отступ между input и description:** 4px
- **Отступ между description и следующим полем:** 16px

### Отступы для таблицы
- **Отступ между панелью инструментов и таблицей:** 16px
- **Отступ между таблицей и пагинацией:** 24px
- **Внутренние отступы ячеек таблицы:** 12px (вертикальный), 16px (горизонтальный)

---

## Компонентная карта страницы

### Полный список компонентов на странице "Категории"

#### Страница списка категорий (`/knowledge-categories`)
1. **Breadcrumbs** - навигационная цепочка
2. **Heading (h1)** - "Категории"
3. **Link (Button)** - "Создать"
4. **Button** - "Фильтр" (с бейджем количества активных фильтров)
5. **Popover/Dropdown** - модалка фильтров
   - **Tree Selector** - "Родительская категория"
   - **Button** - "Сбросить"
6. **Button** - "Переключить столбцы"
7. **Popover/Dropdown** - меню переключения столбцов
   - **Checkbox** - "Created at"
   - **Checkbox** - "Updated at"
8. **Searchbox** - поле поиска
9. **Table** - таблица категорий
   - **Table Header** - заголовки столбцов
   - **Checkbox** - "Выбрать все"
   - **Button** - сортировка по "Заголовок"
   - **Table Row** - строки данных (динамические)
   - **Checkbox** - в каждой строке
   - **Link** - название категории (с иконкой)
   - **Link** - количество подкатегорий
   - **Link** - количество статей
   - **Button** - "Показать подкатегории"
   - **Link** - "Редактировать"
   - **Button** - "Удалить"
10. **Modal/Dialog** - подтверждение удаления
11. **Pagination** - пагинация
    - **Combobox** - "на страницу" (10, 25, 50, 100)
    - **Text** - информация о страницах

#### Страница создания категории (`/knowledge-categories/create`)
1. **Breadcrumbs** - навигационная цепочка
2. **Heading (h1)** - "Создать Категория"
3. **Form** - форма создания
   - **Tree Selector** - "Родительская категория" (optional)
   - **Textbox** - "Заголовок" (required)
   - **Textarea** - "Описание" (optional)
4. **Button Group** - действия формы
   - **Button (Primary)** - "Создать"
   - **Button (Secondary)** - "Создать и Создать еще"
   - **Button (Secondary)** - "Отмена"

#### Страница редактирования категории (`/knowledge-categories/{id}/edit`)
1. **Breadcrumbs** - навигационная цепочка
2. **Heading (h1)** - "Редактирование {Название}"
3. **Button (Danger)** - "Удалить"
4. **Form** - форма редактирования
   - **Tree Selector** - "Родительская категория" (optional)
   - **Textbox** - "Заголовок" (required)
   - **Textarea** - "Описание" (optional)
5. **Section** - "Knowledge Items" (только при редактировании)
   - **Searchbox** - поиск статей
   - **Button** - "Фильтр"
   - **Button** - "Переключить столбцы"
   - **Empty State** - "Не найдено Статьиs" (если нет статей)
6. **Button Group** - действия формы
   - **Button (Primary)** - "Сохранить"
   - **Button (Secondary)** - "Отмена"
7. **Modal/Dialog** - подтверждение удаления

---

## Визуальное разделение секций

### Структура секции
Каждая секция представляет собой отдельную карточку (card) со следующими характеристиками:

#### Визуальные параметры карточки секции
- **Фон:** #FFFFFF (белый)
- **Тень:** 
  - `box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1)`
  - `box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05)` (при hover)
- **Граница:** 
  - `border: 1px solid #E5E7EB` (светло-серый)
  - `border-radius: 8px`
- **Внутренние отступы:** 
  - `padding: 24px` (desktop)
  - `padding: 20px` (tablet)
  - `padding: 16px` (mobile)
- **Отступ снизу:** `margin-bottom: 32px`

#### Заголовок секции
- **Структура:**
  - Заголовок (h3) - жирный, размер: 18px
  - Описание (paragraph) - обычный, размер: 14px, цвет: #6B7280
- **Отступы:**
  - `margin-bottom: 16px` (между заголовком и содержимым)

---

## Цветовая палитра

### Основные цвета
- **Фон страницы:** #F9FAFB (светло-серый)
- **Фон карточек:** #FFFFFF (белый)
- **Фон overlay:** rgba(0, 0, 0, 0.5) (50% прозрачности черного)

### Цвета текста
- **Основной текст:** #111827 (темно-серый, почти черный)
- **Вторичный текст:** #6B7280 (серый)
- **Текст описаний:** #9CA3AF (светло-серый)
- **Текст ошибок:** #DC2626 (красный)
- **Текст успеха:** #10B981 (зеленый)

### Цвета границ
- **Основная граница:** #E5E7EB (светло-серый)
- **Граница при фокусе:** #3B82F6 (синий)
- **Граница ошибки:** #DC2626 (красный)

### Цвета кнопок
- **Primary (Создать/Сохранить):**
  - Фон: #3B82F6 (синий)
  - Текст: #FFFFFF (белый)
  - Hover: #2563EB (темно-синий)
  - Disabled: #9CA3AF (серый)
- **Secondary (Отмена):**
  - Фон: прозрачный
  - Текст: #6B7280 (серый)
  - Граница: #E5E7EB (светло-серый)
  - Hover: #F3F4F6 (светло-серый фон)
- **Danger (Удалить):**
  - Фон: #DC2626 (красный)
  - Текст: #FFFFFF (белый)
  - Hover: #B91C1C (темно-красный)

### Цвета таблицы
- **Фон заголовка:** #F9FAFB (светло-серый)
- **Граница строк:** #E5E7EB (светло-серый)
- **Hover строки:** #F3F4F6 (светло-серый)
- **Активная строка:** #DBEAFE (светло-синий)

---

## Типографика

### Шрифт
- **Семейство:** System font stack или кастомный шрифт
- **Базовый размер:** 16px
- **Line height:** 1.5 (24px)

### Заголовки
- **H1 (Заголовок страницы):**
  - Размер: 32px
  - Вес: 700 (bold)
  - Line height: 1.2
  - Цвет: #111827
  - Margin-bottom: 24px

- **H3 (Заголовок секции):**
  - Размер: 18px
  - Вес: 600 (semi-bold)
  - Line height: 1.3
  - Цвет: #111827
  - Margin-bottom: 16px

- **H4 (Заголовок подсекции):**
  - Размер: 16px
  - Вес: 600 (semi-bold)
  - Line height: 1.4
  - Цвет: #111827
  - Margin-bottom: 12px

### Текст
- **Основной текст:**
  - Размер: 16px
  - Вес: 400 (regular)
  - Line height: 1.5
  - Цвет: #111827

- **Вторичный текст (описания):**
  - Размер: 14px
  - Вес: 400 (regular)
  - Line height: 1.5
  - Цвет: #6B7280

- **Мелкий текст (подсказки):**
  - Размер: 12px
  - Вес: 400 (regular)
  - Line height: 1.4
  - Цвет: #9CA3AF

### Labels (Метки полей)
- **Размер:** 14px
- **Вес:** 500 (medium)
- **Цвет:** #111827
- **Margin-bottom:** 8px

### Placeholder
- **Размер:** 16px
- **Цвет:** #9CA3AF

### Обязательный маркер (*)
- **Размер:** 14px
- **Цвет:** #DC2626 (красный)
- **Расположение:** Справа от label или как superscript

---

## Иконки и их расположение

### Размеры иконок
- **Иконки категорий:** 20px × 20px
- **Иконки в кнопках:** 16px × 16px
- **Иконки в таблице:** 16px × 16px
- **Иконки в dropdown:** 12px × 12px
- **Иконки действий:** 16px × 16px

### Иконки по элементам
- **Иконка категории:** Folder/Book icon (20px)
- **Иконка фильтра:** Filter icon (16px)
- **Иконка переключения столбцов:** Columns icon (16px)
- **Иконка редактирования:** Edit/Pencil icon (16px)
- **Иконка удаления:** Trash/Delete icon (16px)
- **Иконка показа подкатегорий:** Chevron Right/Down (16px)
- **Иконка закрытия модального окна:** X icon (20px)
- **Иконка стрелки dropdown:** Chevron Down (12px)

---

## Grid система и Layout

### Общая структура
- **Container:** max-width: 1200px, margin: 0 auto
- **Grid columns:** 12 колонок (desktop)
- **Gap между колонками:** 24px

### Расположение элементов

#### Header
- **Высота:** 64px (fixed)
- **Padding:** 16px 24px
- **Grid:** Flexbox или Grid для выравнивания элементов

#### Sidebar
- **Ширина:** 256px (desktop, expanded)
- **Ширина:** 64px (collapsed)
- **Position:** fixed, left: 0
- **Height:** 100vh

#### Main Content
- **Margin-left:** 256px (когда sidebar expanded)
- **Margin-left:** 64px (когда sidebar collapsed)
- **Padding:** 24px
- **Max-width:** 1200px

#### Панель инструментов
- **Расположение:** Flexbox, горизонтальное
- **Gap:** 12px между элементами
- **Выравнивание:** justify-content: space-between

#### Таблица
- **Ширина:** 100%
- **Overflow:** horizontal scroll на мобильных
- **Border-collapse:** separate
- **Border-spacing:** 0

---

## Анимации и переходы

### Длительности
- **Быстрые переходы:** 150ms (hover эффекты)
- **Стандартные переходы:** 200ms (открытие/закрытие dropdown)
- **Медленные переходы:** 300ms (модальные окна)

### Easing функции
- **Стандартный:** ease-in-out
- **Bounce:** cubic-bezier(0.68, -0.55, 0.265, 1.55) (для модальных окон)
- **Smooth:** cubic-bezier(0.4, 0, 0.2, 1)

### Анимации компонентов

#### Dropdown/Popover
- **Открытие:** 
  - opacity: 0 → 1 (200ms)
  - transform: translateY(-8px) → translateY(0)
  - easing: ease-out
- **Закрытие:**
  - opacity: 1 → 0 (150ms)
  - transform: translateY(0) → translateY(-8px)

#### Модальное окно
- **Открытие:**
  - opacity: 0 → 1 (300ms)
  - transform: scale(0.95) → scale(1)
  - easing: cubic-bezier(0.68, -0.55, 0.265, 1.55)
- **Overlay:**
  - opacity: 0 → 0.5 (300ms)

#### Таблица
- **Hover строки:**
  - background-color transition: 150ms
  - easing: ease-in-out

---

## Пустые состояния и Edge Cases

### Пустое состояние таблицы
- **Когда отображается:** Нет категорий, соответствующих фильтрам
- **Структура:**
  - Иконка (иллюстрация)
  - Заголовок: "Не найдено Категории"
  - Описание: "Попробуйте изменить фильтры или создать новую категорию"
  - Кнопка: "Создать" (опционально)

### Edge Cases

#### Очень длинное название категории
- **Обработка:** Обрезка с многоточием (...)
- **Tooltip:** Показывает полное название при hover
- **Max-width:** 300px для ячейки

#### Большое количество подкатегорий
- **Обработка:** Показывается количество, клик открывает фильтр
- **Производительность:** Ленивая загрузка при раскрытии

#### Одновременное редактирование
- **Обработка:** Блокировка редактирования другим пользователем
- **Уведомление:** "Категория редактируется другим пользователем"

---

## Список всех компонентов для реализации

### Базовые компоненты
1. **Breadcrumbs** - навигационная цепочка
2. **Heading** - заголовки (h1, h3, h4)
3. **Button** - кнопки (Primary, Secondary, Danger)
4. **Link** - ссылки
5. **Textbox** - текстовые поля
6. **Textarea** - многострочные поля
7. **Checkbox** - чекбоксы
8. **Searchbox** - поле поиска
9. **Table** - таблица
10. **Modal/Dialog** - модальные окна
11. **Popover/Dropdown** - выпадающие меню
12. **Tree Selector** - иерархический выбор
13. **Combobox** - комбинированное поле
14. **Pagination** - пагинация
15. **Badge** - бейдж для счетчиков
16. **Icon** - иконки
17. **Empty State** - пустое состояние
18. **Tooltip** - подсказки

### Специфичные компоненты
1. **CategoryTable** - таблица категорий с поддержкой иерархии
2. **CategoryForm** - форма создания/редактирования категории
3. **CategoryFilter** - фильтр категорий
4. **CategoryTreeSelector** - дерево категорий для выбора
5. **DeleteCategoryModal** - модальное окно подтверждения удаления

---

## API спецификации (детальные)

### Базовый URL
- **Production:** `https://aai.widgets.wearekwid.com/api`
- **Development:** `http://localhost:3000/api`

### Аутентификация
- **Тип:** Bearer Token (JWT)
- **Header:** `Authorization: Bearer {token}`
- **Refresh Token:** Через `/api/auth/refresh`
- **Expiration:** Access token - 15 минут, Refresh token - 7 дней

### Формат запросов/ответов
- **Content-Type:** `application/json`
- **Accept:** `application/json`
- **Кодировка:** UTF-8

### Endpoints для страницы "Категории"

#### 1. Получение списка категорий
```
GET /api/knowledge-categories
Query Parameters:
  - page: number (default: 1)
  - limit: number (default: 10, max: 100)
  - search: string (optional, поиск по названию)
  - parent_id: number (optional, фильтр по родительской категории)
  - sort: string (optional, "title" | "created_at" | "updated_at")
  - order: "asc" | "desc" (default: "desc")

Response 200:
{
  "data": [
    {
      "id": number,
      "title": "string",
      "description": "string",
      "parentId": number | null,
      "subcategoriesCount": number,
      "articlesCount": number,
      "createdAt": "ISO 8601",
      "updatedAt": "ISO 8601"
    }
  ],
  "pagination": {
    "page": number,
    "limit": number,
    "total": number,
    "totalPages": number
  }
}
```

#### 2. Создание категории
```
POST /api/knowledge-categories
Body:
{
  "title": "string" (required, min: 1, max: 255),
  "description": "string" (optional, max: 1000),
  "parentId": number | null (optional)
}

Response 201:
{
  "data": {
    "id": number,
    "title": "string",
    "description": "string",
    "parentId": number | null,
    "createdAt": "ISO 8601",
    "updatedAt": "ISO 8601"
  }
}

Error 400:
{
  "error": "ValidationError",
  "message": "Заголовок обязательно",
  "fields": {
    "title": ["Заголовок обязательно"]
  }
}
```

#### 3. Получение категории
```
GET /api/knowledge-categories/{id}

Response 200:
{
  "data": {
    "id": number,
    "title": "string",
    "description": "string",
    "parentId": number | null,
    "subcategoriesCount": number,
    "articlesCount": number,
    "createdAt": "ISO 8601",
    "updatedAt": "ISO 8601"
  }
}

Error 404:
{
  "error": "NotFoundError",
  "message": "Категория не найдена"
}
```

#### 4. Обновление категории
```
PUT /api/knowledge-categories/{id}
Body:
{
  "title": "string" (optional),
  "description": "string" (optional),
  "parentId": number | null (optional)
}

Response 200:
{
  "data": {
    "id": number,
    ... (обновленные данные)
  }
}
```

#### 5. Удаление категории
```
DELETE /api/knowledge-categories/{id}

Response 204: No Content

Error 404:
{
  "error": "NotFoundError",
  "message": "Категория не найдена"
}

Error 400:
{
  "error": "ValidationError",
  "message": "Невозможно удалить категорию с подкатегориями или статьями"
}
```

#### 6. Получение дерева категорий
```
GET /api/knowledge-categories/tree

Response 200:
{
  "data": [
    {
      "id": number,
      "title": "string",
      "children": [
        {
          "id": number,
          "title": "string",
          "children": []
        }
      ]
    }
  ]
}
```

### Rate Limiting
- **Стандартные запросы:** 100 запросов в минуту
- **Создание/обновление:** 20 запросов в минуту
- **Удаление:** 10 запросов в минуту

### Коды ошибок
- **200:** Успешный запрос
- **201:** Успешное создание
- **204:** Успешное удаление
- **400:** Ошибка валидации
- **401:** Не авторизован
- **403:** Нет доступа
- **404:** Не найдено
- **429:** Превышен лимит запросов
- **500:** Внутренняя ошибка сервера

---

## Детальные состояния загрузки

### Skeleton Loaders

#### Таблица категорий
- **Структура:** 5-10 строк с placeholder'ами
- **Анимация:** Пульсация (shimmer effect)
- **Высота строки:** 56px
- **Ширина колонок:** Пропорциональная реальным колонкам

#### Форма создания/редактирования
- **Поля:** Placeholder прямоугольники с закругленными углами
- **Высота:** Соответствует реальным полям
- **Отступы:** Соответствуют реальным отступам

### Spinner'ы
- **Размер:** 24px × 24px
- **Цвет:** #3B82F6 (синий)
- **Расположение:** Центр контейнера
- **Анимация:** Вращение 360° за 1 секунду

### Прогресс-бары
- **Высота:** 4px
- **Цвет:** #3B82F6 (синий)
- **Анимация:** Индетерминированный прогресс (бегущая полоса)

### Оптимистичные обновления
- **Создание:** Категория появляется в таблице сразу
- **Обновление:** Изменения применяются сразу
- **Удаление:** Категория исчезает из таблицы сразу
- **Откат:** При ошибке возвращается предыдущее состояние

---

## Валидация форм (детальная)

### Поле "Заголовок"
- **Обязательное:** Да
- **Минимальная длина:** 1 символ
- **Максимальная длина:** 255 символов
- **Паттерн:** Любые символы
- **Сообщения об ошибках:**
  - Пустое: "Заголовок обязательно"
  - Слишком длинное: "Заголовок не может быть длиннее 255 символов"

### Поле "Описание"
- **Обязательное:** Нет
- **Максимальная длина:** 1000 символов
- **Сообщения об ошибках:**
  - Слишком длинное: "Описание не может быть длиннее 1000 символов"

### Поле "Родительская категория"
- **Обязательное:** Нет
- **Валидация:** Нельзя выбрать саму категорию или её подкатегории
- **Сообщения об ошибках:**
  - Циклическая зависимость: "Нельзя выбрать эту категорию в качестве родительской"

### Кросс-полевая валидация
- **Проверка циклических зависимостей:** При изменении родительской категории
- **Проверка уникальности:** Название должно быть уникальным в рамках родительской категории

---

## Responsive Design (точные breakpoints)

### Breakpoints
- **Mobile:** ≤ 767px
- **Tablet:** 768px - 1023px
- **Desktop:** ≥ 1024px
- **Large Desktop:** ≥ 1440px

### Адаптация компонентов

#### Таблица
- **Desktop:** Полная таблица со всеми колонками
- **Tablet:** Скрываются некоторые колонки, горизонтальный скролл
- **Mobile:** Карточки вместо таблицы, вертикальный список

#### Панель инструментов
- **Desktop:** Горизонтальное расположение всех элементов
- **Tablet:** Горизонтальное расположение, уменьшенные отступы
- **Mobile:** Вертикальное расположение, полная ширина элементов

#### Форма
- **Desktop:** Максимальная ширина 800px, центрирована
- **Tablet:** Максимальная ширина 100%, отступы 20px
- **Mobile:** Полная ширина, отступы 16px

#### Модальное окно
- **Desktop:** Центрировано, ширина 500px
- **Tablet:** Центрировано, ширина 90%
- **Mobile:** Полная ширина, отступы 16px

---

## Z-index слои

### Порядок наложения
1. **Base content:** z-index: 1
2. **Sticky elements:** z-index: 10
3. **Dropdowns:** z-index: 100
4. **Popovers:** z-index: 200
5. **Modals:** z-index: 1000
6. **Notifications:** z-index: 2000
7. **Tooltips:** z-index: 3000

### Конкретные значения
- **Header:** z-index: 100
- **Sidebar:** z-index: 50
- **Dropdown фильтров:** z-index: 200
- **Dropdown столбцов:** z-index: 200
- **Модальное окно удаления:** z-index: 1000
- **Overlay модального окна:** z-index: 999

---

## Focus states (детальные)

### Визуальные индикаторы
- **Цвет:** #3B82F6 (синий)
- **Толщина:** 2px
- **Стиль:** solid
- **Offset:** 2px (outline-offset)

### Порядок табуляции
1. Кнопка "Создать"
2. Поле поиска
3. Кнопка "Фильтр"
4. Кнопка "Переключить столбцы"
5. Элементы таблицы (по порядку)
6. Пагинация
7. Кнопки действий формы

### Keyboard navigation
- **Tab:** Следующий элемент
- **Shift+Tab:** Предыдущий элемент
- **Enter/Space:** Активация элемента
- **Escape:** Закрытие модальных окон/dropdown'ов
- **Arrow keys:** Навигация в таблице/dropdown'ах

---

## Hover/Active/Pressed states

### Кнопки
- **Hover:**
  - Primary: background-color: #2563EB
  - Secondary: background-color: #F3F4F6
  - Danger: background-color: #B91C1C
- **Active:**
  - transform: scale(0.98)
  - transition: 100ms
- **Pressed:**
  - box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1)

### Ссылки
- **Hover:**
  - text-decoration: underline
  - color: #2563EB
- **Active:**
  - color: #1E40AF

### Строки таблицы
- **Hover:**
  - background-color: #F3F4F6
  - transition: 150ms

### Dropdown элементы
- **Hover:**
  - background-color: #F3F4F6
- **Active:**
  - background-color: #DBEAFE

---

## Тени и эффекты (точные значения)

### Тени карточек
- **Стандартная:** `box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1)`
- **Hover:** `box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05)`
- **Elevated:** `box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1)`

### Тени модальных окон
- **Overlay:** `box-shadow: 0 20px 25px rgba(0, 0, 0, 0.15)`

### Тени dropdown'ов
- **Стандартная:** `box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1)`

### Тени кнопок
- **Hover:** `box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1)`
- **Active:** `box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1)`

---

## Скругления (точные значения)

### Компоненты
- **Карточки:** border-radius: 8px
- **Кнопки:** border-radius: 6px
- **Поля ввода:** border-radius: 6px
- **Модальные окна:** border-radius: 12px
- **Dropdown'ы:** border-radius: 8px
- **Теги:** border-radius: 4px
- **Иконки:** border-radius: 50% (круглые)

---

## Шрифты

### Семейство шрифтов
- **Основной:** System font stack
  - `-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif`
- **Моноширинный:** `"SF Mono", Monaco, "Cascadia Code", "Roboto Mono", Consolas, "Courier New", monospace`

### Размеры
- **Base:** 16px
- **Small:** 14px
- **XSmall:** 12px
- **Large:** 18px
- **XLarge:** 24px
- **XXLarge:** 32px

### Веса
- **Regular:** 400
- **Medium:** 500
- **Semi-bold:** 600
- **Bold:** 700

---

## Иконки (детальные требования)

### Библиотека
- **Рекомендуется:** Lucide React, Heroicons, или аналогичная
- **Формат:** SVG
- **Размеры:** 12px, 16px, 20px, 24px

### Иконки для страницы категорий
- **Категория:** Folder, Book, или FolderOpen
- **Фильтр:** Filter или SlidersHorizontal
- **Столбцы:** Columns или LayoutGrid
- **Редактирование:** Pencil или Edit
- **Удаление:** Trash или X
- **Показать подкатегории:** ChevronRight или ChevronDown
- **Закрыть:** X
- **Стрелка dropdown:** ChevronDown

---

## Бизнес-логика

### Иерархия категорий
- **Максимальная глубина:** 5 уровней
- **Проверка циклических зависимостей:** При изменении родительской категории
- **Каскадное удаление:** Опционально (настраивается)

### Ограничения
- **Название должно быть уникальным:** В рамках родительской категории
- **Нельзя удалить категорию:** Если есть подкатегории или статьи
- **Нельзя выбрать родительской:** Саму категорию или её подкатегории

### Автоматические действия
- **Подсчет статей:** Автоматически при создании/удалении статьи
- **Подсчет подкатегорий:** Автоматически при создании/удалении подкатегории

---

## Обработка ошибок (детальная)

### Типы ошибок

#### Валидация
- **Отображение:** Под полем ввода
- **Стиль:** Красный текст, красная граница поля
- **Пример:** "Заголовок обязательно"

#### API ошибки
- **400 Bad Request:** Toast уведомление + ошибки в форме
- **401 Unauthorized:** Редирект на страницу входа
- **403 Forbidden:** Toast уведомление "Нет доступа"
- **404 Not Found:** Toast уведомление "Категория не найдена"
- **429 Too Many Requests:** Toast уведомление "Слишком много запросов"
- **500 Internal Server Error:** Toast уведомление "Ошибка сервера"

### Toast уведомления
- **Успех:** Зеленый, иконка checkmark
- **Ошибка:** Красный, иконка X
- **Предупреждение:** Оранжевый, иконка warning
- **Информация:** Синий, иконка info

### Retry логика
- **Автоматический retry:** Для сетевых ошибок (3 попытки)
- **Экспоненциальная задержка:** 1s, 2s, 4s

---

## Производительность

### Оптимизации

#### Ленивая загрузка
- **Подкатегории:** Загружаются только при раскрытии
- **Статьи в категории:** Загружаются только при открытии страницы редактирования

#### Виртуализация
- **Таблица:** Виртуализация строк при большом количестве (>100)

#### Кэширование
- **Дерево категорий:** Кэшируется на 5 минут
- **Список категорий:** Кэшируется на 1 минуту

#### Debounce
- **Поиск:** 300ms debounce
- **Фильтры:** 500ms debounce

---

## Безопасность

### Аутентификация
- **JWT токены:** Хранятся в httpOnly cookies
- **Refresh токены:** Отдельные токены с большим сроком действия

### Авторизация
- **RBAC:** Role-Based Access Control
- **Проверка прав:** На уровне API и UI

### Валидация
- **На клиенте:** Для UX
- **На сервере:** Обязательная для безопасности
- **Sanitization:** Очистка пользовательского ввода

### CSRF защита
- **Токены:** CSRF токены для всех изменяющих запросов

---

## Тестирование

### Unit тесты
- **Компоненты:** React Testing Library
- **Утилиты:** Jest
- **Покрытие:** Минимум 80%

### Integration тесты
- **Формы:** Тестирование валидации и отправки
- **Таблица:** Тестирование фильтрации и сортировки

### E2E тесты
- **Playwright или Cypress:** Полные сценарии использования
- **Сценарии:**
  - Создание категории
  - Редактирование категории
  - Удаление категории
  - Фильтрация категорий
  - Поиск категорий

---

## Примеры кода

### Компонент таблицы категорий
```typescript
import { useState } from 'react';
import { useQuery } from '@tanstack/react-query';

interface Category {
  id: number;
  title: string;
  description: string;
  parentId: number | null;
  subcategoriesCount: number;
  articlesCount: number;
}

export function CategoriesTable() {
  const [filters, setFilters] = useState({
    search: '',
    parentId: null as number | null,
  });
  const [page, setPage] = useState(1);
  const [limit, setLimit] = useState(10);

  const { data, isLoading, error } = useQuery({
    queryKey: ['categories', filters, page, limit],
    queryFn: () => fetchCategories({ ...filters, page, limit }),
  });

  if (isLoading) return <CategoriesTableSkeleton />;
  if (error) return <ErrorMessage error={error} />;

  return (
    <table>
      <thead>
        <tr>
          <th><Checkbox /></th>
          <th><SortableHeader column="title">Заголовок</SortableHeader></th>
          <th>Подкатегории</th>
          <th>Статьи</th>
          <th>Действия</th>
        </tr>
      </thead>
      <tbody>
        {data?.data.map((category) => (
          <CategoryRow key={category.id} category={category} />
        ))}
      </tbody>
    </table>
  );
}
```

### Компонент формы категории
```typescript
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { z } from 'zod';

const categorySchema = z.object({
  title: z.string().min(1, 'Заголовок обязательно').max(255),
  description: z.string().max(1000).optional(),
  parentId: z.number().nullable().optional(),
});

export function CategoryForm({ categoryId }: { categoryId?: number }) {
  const { register, handleSubmit, formState: { errors } } = useForm({
    resolver: zodResolver(categorySchema),
  });

  const onSubmit = async (data: z.infer<typeof categorySchema>) => {
    if (categoryId) {
      await updateCategory(categoryId, data);
    } else {
      await createCategory(data);
    }
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)}>
      <div>
        <label htmlFor="title">
          Заголовок <span>*</span>
        </label>
        <input
          id="title"
          {...register('title')}
          aria-invalid={errors.title ? 'true' : 'false'}
        />
        {errors.title && (
          <span role="alert">{errors.title.message}</span>
        )}
      </div>

      <div>
        <label htmlFor="description">Описание</label>
        <textarea id="description" {...register('description')} />
      </div>

      <div>
        <label htmlFor="parentId">Родительская категория</label>
        <TreeSelector
          id="parentId"
          {...register('parentId')}
        />
      </div>

      <button type="submit">
        {categoryId ? 'Сохранить' : 'Создать'}
      </button>
    </form>
  );
}
```

---

## Логирование и мониторинг

### Что логировать
- **Создание категории:** ID, название, родительская категория
- **Обновление категории:** ID, измененные поля
- **Удаление категории:** ID, название
- **Ошибки:** Полная информация об ошибке, stack trace

### Уровни логов
- **Error:** Критические ошибки
- **Warn:** Предупреждения
- **Info:** Информационные сообщения
- **Debug:** Детальная информация (только в development)

---

## Доступность (расширенная)

### ARIA атрибуты
- **aria-label:** Для всех интерактивных элементов без видимого текста
- **aria-describedby:** Для полей с описаниями
- **aria-invalid:** Для полей с ошибками
- **aria-required:** Для обязательных полей
- **aria-expanded:** Для раскрывающихся элементов
- **aria-live:** Для динамического контента

### Keyboard navigation
- **Tab:** Навигация по элементам
- **Enter/Space:** Активация
- **Escape:** Закрытие модальных окон
- **Arrow keys:** Навигация в таблице

### Screen readers
- **Семантический HTML:** Правильное использование тегов
- **Alt тексты:** Для всех изображений
- **Скрытые тексты:** Для визуальных элементов без текста

---

## Интернационализация (i18n)

### Поддерживаемые языки
- **Основной:** Русский (ru)
- **Дополнительные:** Английский (en) - опционально

### Форматирование
- **Даты:** Формат зависит от локали
- **Числа:** Формат зависит от локали

### Переводы
- **Все тексты:** В файлах переводов
- **Динамические тексты:** Плейсхолдеры для переменных

---

## Деплой и окружения

### Окружения
- **Development:** `http://localhost:3000`
- **Staging:** `https://staging.aai.widgets.wearekwid.com`
- **Production:** `https://aai.widgets.wearekwid.com`

### CI/CD
- **Автоматический деплой:** При merge в main
- **Тесты:** Запускаются перед деплоем
- **Rollback:** Автоматический при ошибках

---

## Версионирование API

### Формат версий
- **Текущая версия:** v1
- **Формат:** `/api/v1/knowledge-categories`

### Изменения
- **Breaking changes:** Новая major версия
- **Новые endpoints:** Без изменения версии
- **Deprecation:** За 3 месяца до удаления

---

## Документация для пользователей

### Tooltips и подсказки
- **Поле "Родительская категория":** "Выберите родительскую категорию для создания иерархии"
- **Поле "Заголовок":** "Название категории, которое будет отображаться в списке"
- **Поле "Описание":** "Дополнительное описание категории (необязательно)"

### Help тексты
- **Под формой:** "Категории помогают организовать вашу базу знаний. Создайте иерархию категорий для удобной навигации."

---

**Дата создания отчета:** 2025-11-11
**Дата последнего обновления:** 2025-01-26
**Версия:** 4.0
**Статус:** Полностью протестировано и детализировано для репликации

