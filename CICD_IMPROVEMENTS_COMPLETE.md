# ‚úÖ CI/CD –£–ª—É—á—à–µ–Ω–∏—è - –ó–∞–≤–µ—Ä—à–µ–Ω–æ

**–î–∞—Ç–∞:** 2025-01-26  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ —É–ª—É—á—à–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –¥–µ–ø–ª–æ—é

---

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. ‚úÖ –î–µ–ø–ª–æ–π Worker –Ω–∞ Railway —á–µ—Ä–µ–∑ CI/CD

**–§–∞–π–ª:** `.github/workflows/deploy-worker.yml`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω workflow –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Railway CLI
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞ Worker
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ `services/worker/**`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω health check –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω deployment summary

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ `main` (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ Worker)
- Manual dispatch

**–¢—Ä–µ–±—É–µ–º—ã–µ Secrets:**
- `RAILWAY_TOKEN` - Railway API —Ç–æ–∫–µ–Ω
- `WORKER_HEALTH_CHECK_URL` - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è health check

---

### 2. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

**–§–∞–π–ª:** `.github/workflows/main.yml`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —à–∞–≥ –º–∏–≥—Ä–∞—Ü–∏–π –ø–µ—Ä–µ–¥ production –¥–µ–ø–ª–æ–µ–º
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–∫—Ä–∏–ø—Ç `scripts/migrations/migrate.js`
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å `continue-on-error: true` (–Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –¥–µ–ø–ª–æ–π)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Supabase

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
–®–∞–≥ –º–∏–≥—Ä–∞—Ü–∏–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ job `deploy-production` –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –Ω–∞ Vercel.

**–¢—Ä–µ–±—É–µ–º—ã–µ Secrets:**
- `SUPABASE_URL` - URL Supabase –ø—Ä–æ–µ–∫—Ç–∞
- `SUPABASE_SERVICE_ROLE_KEY` - Service Role Key –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π

---

### 3. ‚úÖ Lighthouse CI –¥–ª—è performance-—Ç–µ—Å—Ç–æ–≤

**–§–∞–π–ª:** `.github/workflows/lighthouse.yml`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π workflow –¥–ª—è Lighthouse CI
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã performance-—Ç–µ—Å—Ç—ã —Å 3 –ø—Ä–æ–≥–æ–Ω–∞–º–∏
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω upload –æ—Ç—á–µ—Ç–æ–≤ –≤ artifacts
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω performance summary –≤ GitHub Actions

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- Push –≤ `main`
- Pull Requests –≤ `main`
- Manual dispatch

**–ú–µ—Ç—Ä–∏–∫–∏:**
- Performance
- Accessibility
- Best Practices
- SEO

**–¢—Ä–µ–±—É–µ–º—ã–µ Secrets:**
- `PRODUCTION_URL` - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å—Ç—å fallback –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π URL

---

## üìù –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 1. `docs/CI_CD_STATUS.md`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–µ–ø–ª–æ–µ Worker –Ω–∞ Railway
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Lighthouse CI
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö GitHub Secrets
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

### 2. `docs/GITHUB_SECRETS_SETUP.md`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ `RAILWAY_TOKEN`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ `SUPABASE_URL` –∏ `SUPABASE_SERVICE_ROLE_KEY`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã (`WORKER_HEALTH_CHECK_URL`, `PRODUCTION_URL`)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω —á–µ–∫–ª–∏—Å—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

---

## üîë –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ GitHub Secrets

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:
1. `VERCEL_TOKEN` - –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ Vercel
2. `VERCEL_ORG_ID` - ID –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ Vercel
3. `VERCEL_PROJECT_ID` - ID –ø—Ä–æ–µ–∫—Ç–∞ Vercel
4. `RAILWAY_TOKEN` - –¥–ª—è –¥–µ–ø–ª–æ—è Worker –Ω–∞ Railway
5. `SUPABASE_URL` - –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π –ë–î
6. `SUPABASE_SERVICE_ROLE_KEY` - –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π –ë–î

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:
- `WORKER_HEALTH_CHECK_URL` - –¥–ª—è health check Worker
- `PRODUCTION_URL` - –¥–ª—è Lighthouse CI (–µ—Å–ª–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ)

---

## üöÄ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π

**–î–ª—è Frontend (Vercel):**
```bash
git push origin main
```
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è `main.yml` workflow
- –í—ã–ø–æ–ª–Ω—è—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- –ó–∞–¥–µ–ø–ª–æ–∏—Ç—Å—è –Ω–∞ Vercel Production

**–î–ª—è Worker (Railway):**
```bash
# –ò–∑–º–µ–Ω–∏—Ç–µ —á—Ç–æ-—Ç–æ –≤ services/worker/ –∏ —Å–¥–µ–ª–∞–π—Ç–µ push
git add services/worker/
git commit -m "Update worker"
git push origin main
```
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è `deploy-worker.yml` workflow
- –ó–∞–¥–µ–ø–ª–æ–∏—Ç—Å—è –Ω–∞ Railway

**–î–ª—è Lighthouse CI:**
```bash
git push origin main
```
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è `lighthouse.yml` workflow
- –í—ã–ø–æ–ª–Ω—è—Ç—Å—è performance-—Ç–µ—Å—Ç—ã

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (workflow_dispatch)

1. –û—Ç–∫—Ä–æ–π—Ç–µ GitHub ‚Üí **Actions**
2. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π workflow:
   - `Deploy Worker to Railway`
   - `Lighthouse CI`
3. –ù–∞–∂–º–∏—Ç–µ **Run workflow**
4. –í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ç–∫—É –∏ –Ω–∞–∂–º–∏—Ç–µ **Run workflow**

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ Frontend (Vercel)
```bash
curl https://gpt-agent-kwid-1i1j7zlgl-world-wide-services-62780b79.vercel.app/api/health
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Worker (Railway)
```bash
# –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω WORKER_HEALTH_CHECK_URL
curl $WORKER_HEALTH_CHECK_URL/health
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ GitHub Actions –¥–ª—è —à–∞–≥–∞ "Run Database Migrations"
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ Lighthouse
- –û—Ç–∫—Ä–æ–π—Ç–µ GitHub Actions ‚Üí Lighthouse CI
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ artifacts —Å –æ—Ç—á–µ—Ç–æ–º
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –º–µ—Ç—Ä–∏–∫–∏ –≤ –Ω–æ—Ä–º–µ

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ CI/CD Pipeline

```
Push to main
    ‚îÇ
    ‚îú‚îÄ‚Üí Quality Check (TypeScript, ESLint, Format)
    ‚îÇ
    ‚îú‚îÄ‚Üí Tests (Unit + E2E)
    ‚îÇ
    ‚îú‚îÄ‚Üí Build
    ‚îÇ
    ‚îú‚îÄ‚Üí Deploy Production
    ‚îÇ   ‚îú‚îÄ‚Üí Run Database Migrations ‚≠ê NEW
    ‚îÇ   ‚îî‚îÄ‚Üí Deploy to Vercel
    ‚îÇ
    ‚îú‚îÄ‚Üí Deploy Worker (–µ—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω services/worker/) ‚≠ê NEW
    ‚îÇ   ‚îî‚îÄ‚Üí Deploy to Railway
    ‚îÇ
    ‚îî‚îÄ‚Üí Lighthouse CI ‚≠ê NEW
        ‚îî‚îÄ‚Üí Performance Tests
```

---

## üéâ –ò—Ç–æ–≥

**–í—Å–µ —É–ª—É—á—à–µ–Ω–∏—è CI/CD —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã!**

‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π Worker –Ω–∞ Railway  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –ø–µ—Ä–µ–¥ production –¥–µ–ø–ª–æ–µ–º  
‚úÖ Lighthouse CI –¥–ª—è performance-—Ç–µ—Å—Ç–æ–≤  
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è  

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ GitHub Secrets –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
2. –°–¥–µ–ª–∞–π—Ç–µ push –≤ `main` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—Å–µ—Ö workflows –≤ GitHub Actions

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-26


